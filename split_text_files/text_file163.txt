差数据。该工作包的结构示意图和功能模块列表分别见图10.120 和
表10.90。
单次曝光图像误
差
误差计算
协方差计算
协方差矩阵压缩
误差和协方差数
据
图10.120 IFS 天光背景扣除工作包的结构示意图
表10.90 IFS 天光背景扣除工作包的功能模块列表
序号
功能模块名称
输入
输出
实现功能
1
误差计算
单次曝光误差
合成图像误
差
计算各自的独立误差
2
协方差计算
单次曝光误差
协方差矩阵
计算像素之间的协方
差
3
协方差矩阵压缩
协方差矩阵
压缩矩阵
压缩协方差矩阵
160
8.3.3.19 IFS 多次曝光合成文件生成工作包
该工作包（编号：KSC-SJ6-PK-19）主要任务是收集以上图像
合成流程中的所有有用数据，并打包FITS 文件，生成DRP 数据输
入数据库中。主要分为头文件创建，图文件创建，FITS 文件输出这
三个模块。头文件创建模块收集天体测量信息，图像基本星系等有
用数据；图文件创建模块收集流量数据立方，可用性数据立方，误
差数据立方，协方差数据立方等数据。上述两个模块所需数据参见
1 级数据定义表。随后通过FITS 文件输出将头文件和图文件打包成
FITS 文件，生成一级多次合成数据，经过质量检验和索引之后保存
到数据库中。该工作包的结构示意图和功能模块列表分别见图
10.121 和表10.91。
叠加图像天体测
量信息
叠加图像流量及
可用性数据立方
叠加图像误差数
据立方
数据库
I FS多次
曝光合
成数据
D
R
P数据
头文件创建
图文件创建
FI TS文件输出
图10.121 IFS 多次曝光合成文件生成工作包的结构示意图
表10.91 IFS 多次曝光合成文件生成工作包的功能模块列表
序号
功能模块名称
输入
输出
实现功能
1
头文件创建
天体测量信
息，其他有用
信息
头文件
创建头文件
2
图文件创建
流量，可用
性，误差等数
据立方
图文件
创建图文件
3
FITS 文件输出
头文件和图文
件
合成FITS
文件
输出包含头和图的标
准FITS 文件
4
质量检验、数据
合成FITS 文
合成FITS
质量检查，数据库关
161
库索引
件
文件
键字索引
8.3.3.20 IFS 一级合成数据质量检查工作包
该工作包作为二级数据处理流水线的第一个工作包单元（编号：
KSC-SJ6-PK-20），主要包含三个子模块：1）无效数据点检验，用
于确保使用的光谱数据点全部有效，无inf, nan 等数值；2）光谱流
量误差准确度检验，由于流量误差的确定依赖于很多环节及协方差
估计，给出的数值不一定确保完全准确，此部分将对光谱流量误差
做独立估计，和一级数据给出的误差做对比分析找出最佳合理值；3）
光谱信噪比检验，此子模块用于检验当前数据的信噪比分布是否能
满足科学需求。针对三个子模块的结果，若数据不符合要求，则根
据结果分析数据异常的可能性，反馈给一级数据处理环节，做数据
迭代。若满足要求，则执行下一步的数据空间像素合并模块。该工
作包的结构示意图和功能模块列表分别见图10.122 和表10.92。
图10.122 IFS 一级合成数据质量检查工作包的结构示意图
表10.92 IFS 一级合成数据质量检查工作包的功能模块列表
序号
功能模块名称
输入
输出
实现功能
1
无效数据点检验
一级合成数据
立方
无效数据点
列表
检视数据立方中仅作
为填充的无效数据点
2
流量误差数据点
检验
一级合成数据
立方
误差异常标
记
检视数据立方中误差
异常点并标记
3
信噪比检验
一级合成数据
立方
信噪比异常
检验
检视数据立方中信噪
比异常点并标记
162
8.3.3.21 IFS 数据立方空间像素合并工作包
在IFS 的一级合成数据通过质量检验环节后，本工作包（编号：
KSC-SJ6-PK-21）根据科学需求对一级数据立方进行空间像素合并，
并将合并到一起的像素进行叠谱。叠谱完成之后，将对新的光谱进
行质量分析，确保后续的科学分析需求。该工作包的结构示意图和
功能模块列表分别见图10.123 和表10.93。
图10.123 IFS 合成数据空间像素合并工作包的结构示意图
表10.93 IFS 合成数据空间像素合并工作包的功能模块列表
序号
功能模块名称
输入
输出
实现功能
1
空间像素合并方
案
一级合成数据
立方，合并策
略
像素合并列
表
满足信噪比需求或者
给定方案的像素合并
2
光谱合并
一级合成数据
立方，合并方
案
进行光谱合
并后的数据
立方
按照合并方案进行光
谱合并和数据立方再
生成
8.3.3.22 IFS 积分光谱的吸收线测量工作包
在完成IFS 空间像素合并后，本工作包（编号：KSC-SJ6-PK-
22）首先对光谱进行吸收线拟合，拟合使用和IFS 光谱波长覆盖范
围相近的恒星光谱库。拟合得到星系的恒星运动学参数，以及等值
宽度等科学参数。该工作包的结构示意图和功能模块列表分别见图
10.124 和表10.94。
163
数据库IFS
空
间合并光谱
恒星连续谱
各吸收线等值
宽度
吸收线拟合
恒星光谱库
等值宽度测量
恒星运动学参
数
图10.124 IFS 积分光谱的吸收线测量工作包的结构示意图
表10.94 IFS 积分光谱的吸收线测量工作包的功能模块列表
序号
功能模块名称
输入
输出
实现功能
1
吸收线拟合
光谱合并后的
数据立方
恒星运动学
参数及恒星
连续谱
拟合连续谱，实现恒
星运动学相关的科学
参数提取。
2
等值宽度拟合
拟合得到的恒
星连续谱
各吸收线的
等值宽度
实现吸收线等值宽度
的科学参数提取
8.3.3.23 IFS 积分光谱的发射线测量工作包
在完成吸收线拟合后，可得到扣除恒星连续谱的纯发射线光谱，
对于发射线较强的那些光谱，纯发射线光谱拟合与发射线和吸收线
同时拟合得到的结果会更加接近。而对于那些弱发射线星系，发射
线的拟合结果依赖于信噪比以及拟合使用恒星/星族模版的准确程度。
因此本工作包（编号：KSC-SJ6-PK-23）采取2 种方式拟合发射线：
1）吸收线和发射线同时拟合；2）积分光谱扣除利用吸收线工作包
拟合得到的恒星连续谱，只留存发射线信息做拟合。通过误差分析
等方法提取可信度最高的发射线相关科学参数。该工作包的结构示
意图和功能模块列表分别见图10.125 和表10.95。
164
图10.125 IFS 积分光谱的发射线测量工作包的结构示意图
表10.95 IFS 积分光谱的发收线测量工作包的功能模块列表
序号
功能模块名称
输入
输出
实现功能
1
吸收线发射线同
时拟合
光谱合并后的
数据立方
气体发射线
相关参数结
果1
得到光谱同时拟合对
应的气体发射线测量
结果
2
发射线单独拟合
光谱合并后的
数据立方+恒
星连续谱
气体发射线
相关参数结
果2
得到纯发射线拟合对
应的气体发射线测量
结果
3
两种拟合结果可
信度对比
气体发射线结
果1 和结果
2
气体发射线
科学参数
完成气体发射线相关
科学参数的测量
8.3.3.24 IFS 积分光谱的星族分析工作包
本工作包（编号：KSC-SJ6-PK-24）针对光谱的星族成分进行
拟合分析，得到年龄、金属丰度、尘埃消光、恒星质光比等参数。
星族分析过程中将选取和CSST-IFS 光谱相匹配的星族模版库做拟
合，得到星族各参数。该工作包的结构示意图和功能模块列表分别
见图10.126 和表10.96。
数据库IFS
空
间合并光谱
气体发射线拟
合结果1
气体发射线的
科学参数
吸收线发射线
同时拟合
恒星光谱库
两种拟合结果
可信度对比
恒星连续谱
纯发射线拟合
气体发射线拟
合结果1
165
数据库IFS
空
间合并光谱
恒星形成历史
尘埃消光
光谱星族分析
星族模板库
星族年龄计算
星族金属丰度
计算
恒星质光比计
算
光度和质量加
权的年龄