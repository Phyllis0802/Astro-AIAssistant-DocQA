流水线
KSC-SJ5-PL2-02
图像相减流水线
KSC-SJ5-PL2-03
8.2.2.1
0 级处理流水线-图像评估流水线
0 级数据处理流水线即是图像评估流水线。在每天的观测数据
下来后，首先进行QC0 的科学可用性标记，然后立即促动图像评估
工作包，进行图像的类型检测，将图像分成正常图像和密集星场(星
系团超深场)图像，完成0 级处理流水线。0 级处理流水线图见图
10.83 MCI 图像评估流水线图10.83（流水线编号：KSC-SJ5-PL0-
01）。
图10.83 MCI 图像评估流水线
8.2.2.2
1 级处理流水线
1 级处理流水线包括两个流程，一个是正常图像数据处理流程，
一个是密集星场(星系团超深场)图像数据处理流程，各包含一条流
水线。分别介绍如下：
1. 单幅图像处理流水线
每天数据下来后，在经过图像评估流水线后，判断为正常图像
124
的，触发单幅图像处理流水线。目前假设探测器为CCD。详细过程
如下：在辅助图像及基本参数文件以及仪器效应改正得到的带权重
的图像和flag 图像都具备的条件下，单幅图像处理流水线可以被触
发运行。单幅图像流水线的触发最小单元是一幅原始科学图像。图
像经过overscan 改正后，从参考图像数据库中提取相关的辅助图像
和参数文件，然后进入仪器效应改正流水线进行各种不同类型的探
测器效应改正。在此基础上，与外部星表进行交叉匹配，计算得到
图像的世界坐标系框架（WCS），实现天测位置定标功能。在正确
的世界坐标系框架下，再次利用外部星表和在轨定标流水线的结果，
计算得到单幅图像的流量零点，完成天体流量定标。在定标后的图
像上可以进行星表提取，定标后的单次曝光科学图像和单次曝光星
表会归档存入数据库。图10.84 是单幅图像处理流水线图（流水线
编号：KSC-SJ5-PL1-01）。
图10.84 MCI 单幅图像处理流水线图
2. 密集星场图像处理流水线
每天数据下来后，在经过图像评估流水线后，如果判断为特殊
图像中的密集星场图像，触动密集星场图像处理流水线，得到经过
1 级处理的密集星场图像。密集星场图像处理流水线图见图10.85
（流水线编号：KSC-SJ5-PL1-02）。
图10.85 MCI 密集星场图像处理流水线图
8.2.2.3
2 级处理流水线
在经过1 级处理流水线后，得到了单次曝光图像和星表以及密
集星场(星系团超深场)图像和星表的1 级数据图像。在此基础上触
125
动2 级处理流水线，可以加工获得其它数据产品（1-2 级）。根据
观测策略，超深场天区在每个滤光片波段会被观测至少1500 次。
对单次曝光后的科学图像进行处理后，可以根据滤光片和天区进行
合并，获得更高探测深度的合并图像。在合并图像上进行星表提取，
可以探测到更多的暗弱天体，对高红移天体能获得更准确的形态参
数。我们通过不同的方法可以获得不同的数据产品并归档存入数据
库。主要包括3 个不同的流水线来实现得到各个数据产品（2 级数
据）,见图10.86。
图10.86 MCI 2 级数据处理流水线图
1. 超深场图像合并流水线
超深场图像合并流水线使用同一天区相同波段的多次观测图像，
进行图像合并。合并后的结果为合并图像数据文件，相应的元数据
保存到数据库中。合并图像流水线图见图10.87（流水线编号：
KSC-SJ5-PL2-01）。
图10.87 MCI 超深场图像合并数据流水线图
2. 超深场星表提取流水线
超深场图像星表提取流水线输入是基于获得的单次曝光测光星
表，对单波段的超深场合并图像形成超深场合并星表，最后针对多
波段的数据获得合并的多波段星表，作为2 级数据产品存入数据库。
合并星表流水线图见图10.88（流水线编号：KSC-SJ3-PL2-02）。
图10.88 MCI 超深场图像星表提取流水线图
126
3. 图像相减流水线
最近一次观测图像与同一天区、同一滤光片观测图像模板相减，
相减后的结果为相减图像数据文件，并进一步生成暂现源alerts 和
变源星表，相应的元数据保存到数据库中。图像相减流水线图见图
10.89（流水线编号：KSC-SJ5-PL2-03）。
图10.89 MCI 图像相减流水线图
8.2.3
主要工作包
根据上述数据处理流水线的结构和数据流方向，可以把流水线
分解为下面13 个主要工作包单元，分别是单幅图像处理流水线包
括1 个工作包单元，仪器效应改正流水线包括1 个工作包单元，位
置定标流水线包括1 个工作包单元，流量定标流水线包括1 个工作
包单元，和数据产品-星表生成流水线包括3 个工作包单元。按照职
能划分，每个工作包可以分解为多个工作模块，详见表10.58。各个
流水线工作包列表。下面对每个工作包单元和分解后的工作模块的
功能进行说明。
表10.58 MCI 8 个工作包列表
序号
工作包名称
工作包编号
1
MCI 的0 级数据可用性标记工作包
KSC-SJ5-PK-01
2
图像评估工作包
KSC-SJ5-PK-02
3
MCI 的1 级数据可用性标记工作包
KSC-SJ5-PK-03
4
单次曝光图像处理-仪器效应改正工作包
KSC-SJ5-PK-04
127
5
单次曝光图像处理-位置定标工作包
KSC-SJ5-PK-05
6
单次曝光图像处理-流量定标工作包
KSC-SJ5-PK-06
7
单次曝光星表提取工作包
KSC-SJ5-PK-07
8
超深场图像合并工作包
KSC-SJ5-PK-08
9
超深场星表提取工作包
KSC-SJ5-PK-09
10
图像相减工作包
KSC-SJ5-PK-10
11
暂现源alerts 工作包
KSC-SJ5-PK-11
12
变源星表提取工作包
KSC-SJ5-PK-12
13
MCI 的2 级数据可用性标记工作包
KSC-SJ5-PK-13
8.2.3.1
MCI 的0 级数据可用性标记工作包
该工作包针对MCI 的0 级数据图像，目的是保证观测获得数
据的合理性，并汇报出显著错误。在0 级数据可用性标记工作包中，
主要包含三个模块，分别为：主要参数检查模块，次要参数检查模
块，导星数据模块。所有的0 级数据入库后图像都会先执行QC0
进行标记，进行标记后生成数据检查报告列表和辅助头文件列表返
回到数据库中。该工作包流程图类似多色成像0 级数据可用性标记
工作包流程图，见图10.34（工作包编号：KSC-SJ5-PK-01），模块
列表和功能详见表10.7。
8.2.3.2
MCI 图像评估工作包
该工作包输入信息为0 级MCI 数据图像和一个外部参考信息
表-天区覆盖信息表，然后通过已知特殊天体影响分析和图像异常分
析，得到图像评估结果，从而生成观测天区内将图像分成正常图像
和密集星场(星系团超深场)图像的特殊标记信息。图像评估工作包
流程图类似多色成像图像评估流程图，见图10.36（工作包编号：
KSC-SJ5-PK-02），各模块列表见表10.8。
8.2.3.3
1 级数据可用性标记工作包
该工作包针对MCI 的1 级数据图像，目的是保证MCI 的1 级
数据处理过程中没有出现显著影响MCI 的2 级数据结果的错误，
使得MCI 的1 级数据结果满足MCI 的2 级数据生成观测源表的需
128
求。该工作包流程图类似多色成像1 级数据可用性标记工作包流程
图，见图10.41（工作包编号：KSC-SJ5-PK-03），模块列表和功能
详见表10.14。
8.2.3.4
单次曝光图像处理-仪器效应改正工作包
该工作包处理多通道成像仪单次曝光图像数据仪器效应工作，
是针对0 级数据图像，利用各种参考图像（crosstalk，坏像元，偏
置，平场，暗场等）文件，对0 级科学图像进行一系列的仪器效应
改正。详细过程如下：首先输入crosstalk 系数文件进行Crosstalk、
Overscan 扣除，再输入辅助图像Bias、dark 图像进行bias、dark 改
正，然后做CTE 效应改正，接着输入辅助图像Flat 图像进行Flat
改正。做完Flat 改正后探测宇宙线并进行改正，然后输入非线性系
数文件进行非线性改正，最后对卫星干扰条纹进行探测并改正，得
到改正后的图像、Weight 图像和Flag 图像。工作包流程及模块分解
流程图见图10.90（工作包编号：KSC-SJ5-PK-04），模块列表和功
能详见表10.59。
图10.90 MCI 仪器效应改正工作包
表10.59 MCI 仪器效应改正工作包模块列表
序号
功能模块名
称
输入
输出
实现功能
1
Crosstalk
、
Overscan
扣
除
0 级数据图像，
crosstalk 系数文件
Crosstalk
、
overscan 改正后图
像；饱和像素
flag 图像
改正读出中的crosstalk
效应，改正并扣除
overscan 区域，对饱和像
素进行标记
2
bias、dark 扣
除
上一步产生的改正
图像，合并后的
Bias、dark 参考图
像
扣除bias 、dark
后的图像，坏像
素、热点像素