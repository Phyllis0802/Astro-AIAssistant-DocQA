表10.45 无缝光谱精确位置定标工作包功能模块列表
序号
功能模块名称
输入
输出
实现功能
1
无缝光谱精确位置
定标工作包
无缝光谱对应的伴
随图像和经过初步
位置定标的1 级二
维光谱图像
无缝光谱2
级图像的精
确的位置信
息
获取无缝光
谱2 级图像
的精确的位
置信息
8.1.4.43 基于目标源的一维光谱抽取工作包
该工作包是针对仪器效应改正后的光谱图像进行1 维光谱提取。
首先，基于主天光参考文件进行天光背景扣除；再判断密集星场，
如果是密集星场则进行近邻背景天光扣除；基于配置文件实现光谱
图像的波长定标、流量定标、flat field cube 改正，抽取出一维光谱；
还可以选择高斯发射模型或者流量多维数据集模型加权抽谱；最后，
生成stamp 图像文件，即是在光谱图像中截取出目标源某级像的光
谱图像。工作包流程图及模块分解见图10.73（工作包编号：KSC-
SJ2-PK-14），模块列表和功能详见表10.46。
110
图10.73 基于目标源一维光谱抽取工作包流程图
表10.46 基于目标源的一维光谱提取工作包模块列表
序
号
功能模块
名称
输入
输出
实现功能
1
目标源模
拟缝参数
文件生成
模块
改正后的光谱图像MEF
和目标源星表
目标源模拟缝
参数文件
生成目标源
模拟缝参数
文件
2
主天光背
景扣除
光谱图像；配置文件；
目标源星表；主天光参
考文件
扣除天光背景
的图像文件
扣除天光背
景
3
近邻背景
天光扣除
光谱图像；配置文件；
目标源星表；
基于近邻区域
天光背景生成
的临时文件
扣除近邻区
域天光背景
4
常规光谱
提取
光谱图像；配置文件；
目标源星表；flat field
cube；响应曲线；对应成
像
一维光谱
光谱提取
5
高斯发射
模型加权
抽谱
光谱图像；配置文件；
目标源星表；flat field
cube；响应曲线；不同波
段的对应成像
一维光谱
基于高斯发
射模型的加
权光谱提取
6
流量多维
数据集模
型加权抽
谱
光谱图像；配置文件；
目标源星表；flat field
cube；响应曲线；不同波
段的对应成像；
segmentation
一维光谱
基于流量多
维数据集模
型的加权光
谱提取
7
Stamp
图
像生成
光谱图像；配置文件；
Stamp 图像文件
二维光谱图
像截取
111
8.1.4.44 基于目标源的PSF 一维光谱抽取工作包
该工作包的任务为对已经做了WCS、平场、CTE 等改正之后
的无缝光谱图像，进行抽谱。这部分模块是把无缝光谱数据从2D
到1D 的过程。aXe 的方式是直接利用配置文件中色散方程积分抽
谱，grizli 的正向建模是基于每个pixel 的色散光谱建模整个图片，
利用模板光谱来最小化建模图片与实测图片的差来进行抽谱。而
CSST 的测光与无缝光谱在设计的时候就存在分辨率的差异，加上测
光与无缝光谱的PSF 也会存在差异，本模块是考虑到这个差异，如
何利用这个差异更加有效的提取光谱。
抽谱粒度是一个配置文件中提供的参数，当粒度为1 时，就是
基于单像素的建模抽谱，当粒度增大，可以提升计算速度、简化计
算复杂度，当粒度大过一般psf 大小时，为一般抽谱。工作包流程
图及模块分解见图10.74（工作包编号：KSC-SJ2-PK-15），模块列
表和功能详见表10.47。
基于PSF一维光谱抽取
目标源星表
波长定标得到的配置文件
PSF表
流量定标得到的响应曲线
改正后的二维光谱图像
理论模型光谱库
一维光谱
不同波段的对应成像
Segm
at at i on图像
图10.74 基于目标源的PSF 一维光谱提取工作包流程图
表10.47 基于目标源的PSF 一维光谱提取工作包模块列表
功能模块名称
输入
输出
实现功能
基于目标源的
PSF 一维光谱
提取
光谱图像；配置文
件；目标源星表；flat
field cube ；响应曲
线；对应成像
一维光谱
光谱提取
8.1.4.45 基于正向建模的一维光谱抽取工作包
该工作包针对仪器效应改正后的光谱图像进行正向建模分析。
112
首先，基于主天光参考文件进行天光背景扣除，然后基于多色成像
观测生成0 级像星表和对应的源的segmentation map 用来制作
morphological kernel。正向建模的过程主要分为3 个步骤：（1）使
用flat Fλ作为1 维光谱模型构建2 维光谱图像；（2）使用
polynomials/step-function 作为1 维光谱模型构建2 维光谱图像；（3）
使用光谱库进行模版合成构建2 维光谱图像。步骤（3）同时进行
两步红移拟合，先使用较粗糙的网格搜寻best-fit redshift 的大致范
围，锁定之后使用精细的网格找到红移的全局最优解。步骤（1）-
（3）的过程会不断优化构建2 维光谱图像的模型，并产生红移拟
合的全局最优解，同时得到源的分类（星系、恒星、AGN）及其相
应的物理性质参数星表。工作包流程图及模块分解见图10.75（工作
包编号：KSC-SJ2-PK-16），模块列表和功能详见表10.48。
一维光谱
恒星参数
正向建模一维光
谱抽取
目标源星表
波长定标得到的配
置文件
红移测量
不同波段的对应成
像
Segm
at at i on图像
流量定标得到的响
应曲线
改正后的光谱图
像M
EF
理论模型光谱库
二维光谱图像
红移
星系参数（发射
线流量、等值宽
度等）
图10.75 基于正向建模的一维光谱抽取工作包流程图
表10.48 基于正向建模的一维光谱抽取工作包模块列表
序号
功能模块名
称
输入
输出
实现功能
1
正向建模一
维光谱抽取
光谱图像；配置文
件；目标源星表；
flat field cube ；响
应曲线；对应成
像；segmentation
map；理论模型光
谱库
多次曝光叠加
的一维光谱，
单次曝光的二
维光谱，多次
曝光叠加的二
维光谱，发射
线二维图像
正向建模优
化构建2 维
光谱图像的
模型
2
红移测量
一维光谱，理论模
型光谱库
红移星表，星
系性质参数星
表
通过正向建
模的方法测
量星系红移
与相关物理
参数
113
8.1.4.46 无缝光谱的粗分类与红移测量工作包
该工作包针对无缝光谱2 级一维光谱数据，进行自动分类与红
移测量，分类结果为恒星，星系，类星体，其它。如图10.76，首先
输入1D 光谱，光谱模板库，目标源沿波长方向的轮廓值profile_1d，
探测器沿目标源波长方向的psf_1d。对1D 光谱做数据质量检测和
预处理，根据该光谱的多色测光系统形态分类，对于点源采用
PCAZ 方法将光谱分类为恒星，类星体，星系；对于展源，星系光
谱PCAZ 方法进行红移测量。最终粗分类与红移测量工作包输出分
类类型为：星系，类星体，恒星与未知类型，同时给出红移测量值。
工作包流程图及模块分解见图10.76（工作包编号：KSC-SJ2-PK-
17），模块列表和功能详见表10.49。
数据检查
多色成像出来的形态
轮廓（Pr of i l e_1D
）
无缝光谱探测器轮廓
（PSF_1D
）
光谱模板库：星系模
板库，类星体模板
库，恒星模板库
一维光谱对应的星
表
光谱模板库配置文
件
点源粗分类和红移
输出
数据预处理
（滤波、定标等）
形态类型判
断
点源粗分类和红移
测量
展源粗分类和红移
测量
点源
展源粗分类和红移
输出
展源
一维光谱
图10.76 无缝光谱的粗分类与红移测量工作包流程图
表10.49 无缝光谱的粗分类与红移测量工作包模块列表
序号
功能模块名
称
输入
输出
实现功能
1
数据检查
1）一维光谱对应星
表
2 ）GU 、GV 、GI
的一维无缝光谱
3）探测器在光谱目
标源波长方向上
psf_1d
4）光谱目标源波长
方向上profile_1d
5）光谱模板库
数据完备与
质量检查
对从需要处理的一
维光谱源的三个波
段光谱数据及其数
据质量、测光数
据、相应的仪器psf
等数据进行检查，
符合完备与质量标
准的光谱进行下一
步的分类与红移处
理
2
数据预处理
上一步符合数据检