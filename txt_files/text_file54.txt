改正电荷转移
CTE 效应
4
Flat 改正
上一步产生的改正
图像，合并后的
flat 图像
Flat 改正后
的图像
改正不同像素对
关系响应的差异
5
干扰条纹探测及
改正
上一步产生的改正
图像
干扰扣除后
的图像
对探测图像中的
可能干扰条纹进
行标记及改正
8.3.3.5
IFS 宇宙线扣除工作包
该工作包（编号：KSC-SJ6-PK-05）用于IFS 单次曝光图像中
的宇宙线扣除，具体功能模块包括在输入图像中搜寻宇宙线，在
mask 文件中记录其像元位置，并将宇宙线mask 文件补录入输入文
件。该工作包的结构示意图和功能模块列表分别见图10.107 和表
10.77。
宇宙线搜寻
科学图像
找到的
宇宙线数目
标记宇宙线后
的科学图像
在科学图像中
标记宇宙线
宇宙线屏蔽
=0 或
迭代次数达上限
>0 或
迭代次数未达上限
宇宙线扣除工作包
图10.107 IFS 宇宙线扣除工作包的结构示意图
表10.77 IFS 宇宙线扣除工作包的功能模块列表
序号
功能模块名称
输入
输出
实现功能
1
宇宙线搜寻
科学图像
标记宇宙线位
置的
mask 文
件
寻找宇宙线，并将
其出现的位置及周
边像元标记在
mask 中
2
宇宙线屏蔽
科学图像和宇
宙线
mask 文
件
去除宇宙线之
后的科学图像
将宇宙线从科学图
像中扣除，用以再
次迭代搜寻宇宙线
3
在科学图像中
标记宇宙线
多次迭代后得
到的
mask 文
件
标记宇宙线后
的科学图像
将所得的宇宙线
mask 并入科学图
像的mask 层中
148
8.3.3.6
IFS 光谱成像位置追踪工作包
该工作包（编号：KSC-SJ6-PK-06）利用平场图像追踪32 条
切片在CCD 上的色散后的成像位置。在平场图像上，垂直于色散
方向抽取流量信息，搜寻被32 条切片点亮的区域，记录中心位置。
沿色散方向等间隔抽取、搜寻，从而获得每条切片色散后成像带的
中线位置坐标（散点）。对每条切片中线位置的坐标散点进行多项
式拟合，记录并输出拟合参数，用于后续抽谱工作包。该工作包的
结构示意图和功能模块列表分别见图10.108 和表10.78。
定位每条切片色
散后的中线位置
（散点）
沿色散方向拟合每
条切片的中线位置
Fl at 图像
每条切片色散后的
中线的位置坐标
( 散点)
每条切片色散后中
线位置的拟合结果
光谱成像位置追踪工作包
图10.108 IFS 光谱成像位置追踪工作包的结构示意图
表10.78 IFS 谱成像位置追踪工作包的功能模块列表
序号
功能模块名称
输入
输出
实现功能
1
定位每条切片
色散后成像的
中线位置
平场图像
每条切片色散
后成像的中线
位置坐标（散
点）
沿色散方向等间隔
抽取列信息，对每
一列（垂直于色散
方向）抽取流量信
息，搜寻32 条切
片区域，记录中心
位置。
2
沿色散方向拟
合每条切片的
中线位置
每条切片色散
后成像的中线
位置坐标（散
点）
每条切片色散
后成像的中线
位置的多项式
拟合结果
对每条切片中线位
置的坐标散点进行
多项式拟合。
8.3.3.7
IFS 光谱抽取工作包
该工作包（编号：KSC-SJ6-PK-07）对输入图像进行光谱抽取。
依据光谱追踪的结果，定位切片光谱带位置，对切片边缘效应进行
149
修正，并依据用户的空间采样需求，将光谱带切分成多条光谱，得
到抽谱后的科学图像并输出。该工作包的结构示意图和功能模块列
表分别见图10.109 和表10.79。
定位成像区域
修正边缘效应
科学图像
每条切片中线位
置拟合结果
抽谱后的科学图
像
加权抽谱
光谱抽取工作包
用户空间采样需
求
图10.109 IFS 光谱抽取工作包的结构示意图
表10.79 IFS 光谱抽取工作包的功能模块列表
序号
功能模块名称
输入
输出
实现功能
1
定位成像区域
科学图像、切
片中线位置的
拟合结果
截取切片成像
区域的科学数
据
依据平场的成像位
置追踪结果，抽取
科学图像
2
修正边缘效应
上一步的输出
结果
边缘效应修正
后的科学数据
修正PSF 效应对
边缘的影响
3
加权抽谱
上一步的输出
结果、用户空
间采样需求
抽谱后的科学
图像
依据空间采样需求
沿中线走向进行数
据合并及抽谱
8.3.3.8
IFS 像元-波长对应关系工作包
该工作包（编号：KSC-SJ6-PK-08 ）用于拟合像元- 波长
（PTOW）关系。用抽谱后定标灯图像搜寻发射线，拟合谱线的峰
值位置。通过与定标灯灯谱的实验室波长匹配，认证谱线。确定像
元位置与实验室波长的对应关系，并进行拟合，输出为像元-波长对
应关系文件。该工作包的结构示意图和功能模块列表分别见图
10.110 和表10.80。
150
定标灯图像
谱线认证
像元-波长对应
关系参数文件
定标灯实验室
波长文件
光谱抽取
S
licer成像位置
文件
搜寻谱线
拟合谱线峰值
的像元位置
拟合定标灯谱线
pixel-to-
waveleng
th关系
像元-波长对应关系工作包
图10.110 IFS 像元-波长对应关系工作包的结构示意图
表10.80 IFS 像元-波长对应关系工作包的功能模块列表
序号
功能模块名称
输入
输出
实现功能
1
搜寻谱线
抽谱后的定标
灯图像
谱线位置坐标
在定标灯谱图像中
搜寻发射线
2
谱线峰值位置
搜寻到的发射
线区域
谱线峰值所在
的亚像素位置
拟合谱线的峰值位
置
3
谱线认证
谱线峰值所在
的亚像素位置
坐标、定标灯
实验室波长文
件
匹配上的像素
位置-实验室波
长对
将搜索到的峰值位
置与灯谱波长列表
文件匹配，进行谱
线认证
4
像元- 波长关
系
匹配上的像素
位置-实验室波
长对
多项式拟合结
果
拟合全部像素位
置-实验室波长的
对应关系
8.3.3.9
IFS 波长定标工作包
该工作包（编号：KSC-SJ6-PK-09）对输入光谱进行波长定标。
依据像元-波长对应关系，确定每个像元位置对应的波长。依据卫星
轨道运行参数，进行多普勒效应改正。根据用户波长采样需求，对
所有光谱重新进行波长采样。输出波长定标后的科学图像。该工作
包的结构示意图和功能模块列表分别见图10.111 和表10.81。
151
抽谱后的
科学图像
像元-波长对应
关系参数文件
将每条光谱的
像元位置转化
为波长
波长重新采样
波长定标后的
科学图像
波长定标工作包
卫星轨道运行
参数
轨道运行多普
勒效应修正
用户波长采样
需求
图10.111 IFS 波长定标工作包的结构示意图
表10.81 IFS 波长定标工作包的功能模块列表
序号
功能模块名称
输入
输出
实现功能
1
像元位置转换
波长
抽谱后的科学
图像、像元-
波长对应关系
文件
每条光谱的波
长信息
将每条光谱的像元
位置信息转换为波
长
2
轨道运行多普
勒效应改正
每条光谱的波
长信息、卫星
轨道运行参数
多普勒效应改
正后每条光谱
的波长信息
改正望远镜轨道运
动带来的多普勒位
移
3
波长重新采样
多普勒效应改
正后每条光谱
的波长信息
波长对齐后的
科学图像
依据用户的波长采
样需求，对所有光
谱重新进行波长对
齐采样
8.3.3.10 IFS 流量定标工作包
该工作包（编号：KSC-SJ6-PK-10）利用流量标准星进行流量
定标。通过比对波长定标后的标准星光谱和其本征光谱，计算出随
波长变化的响应曲线。利用该响应曲线，改正波长定标后的单次曝
光光谱，输出为波长流量定标后的光谱文件。该工作包的结构示意
图和功能模块列表分别见图10.112 和表10.82。
152
波长定标后的
标准星图像
标准星本征光
谱
计算随波长变
化的响应曲线
响应曲线改正
波长流量定标
后的科学图像
流量定标工作包
波长定标后的
单次曝光图像
图10.112 IFS 流量定标工作包的结构示意图
表10.82 IFS 流量定标工作包的功能模块列表
序号
功能模块名称
输入
输出
实现功能
1
计算随波长变
化的响应曲线
波长定标后的
标准星光谱、
标准星本征光
谱
响应曲线
比对标准星光谱，
计算在不同波长处
的响应。
2
响应曲线改正
波长定标后的
单次曝光图
像、响应曲线
流量定标后的
科学图像
改正不同波段光子
的响应差异，实现
流量定标
8.3.3.11 IFS LSF 提取工作包
该工作包（编号：KSC-SJ6-PK-11）利用定标灯提取和测量谱
线扩展函数（LSF）。为了尽量多的保留LSF 采样信息，定标灯谱
在波长定标不进行重新采样且不做像元合并。将所有波长定标后的
定标灯谱线融合，并为一条灯谱，利用灯谱间的亚像素位移，增加
采样点。对所有谱线形状进行轮廓拟合，得出LSF 信息。该工作包
的结构示意图和功能模块列表分别见图10.113 和表10.83。
153
抽谱后的
定标灯图像
像元-波长对应
关系参数文件
波长定标
定标灯谱融合
LSF测量结果
LSF工作包
谱线形状拟合
图10.113 IFS LFS 测量工作包的结构示意图
表10.83 IFS LFS 测量工作包的功能模块列表
序号
功能模块名
称
输入
输出
实现功能
1
定标灯谱融
合
IFS 灯谱数据集
融合后的灯
谱
将所有灯谱融合为
一条灯谱
2
谱线形状拟
合
谱线位置处谱形
LSF 测量结
果
拟合谱线形状，得
到LSF 信息
8.3.3.12 IFS 天体测量标定工作包
该工作包（编号：KSC-SJ6-PK-12）输入文件为波长流量定标
后的数据立方，输出为该数据立方的WCS 参数，通过该参数可以
独立解算出数据立方每个像素所对应的天球坐标。输出参数额外写
入最终生成的单次数据立方（参见工作包KSC-SJ6-PK12）。本工
作包分为两个组件，第一个组件是测光图像配准法，通过将IFS 图
像与已知WCS 参数的图像配准来获得对应像素的天球坐标并解算
出WCS 参数。第二个组件是MCI 辅助定标法，通过MCI 观测的
视场内的星点来辅助解算出IFS 的WCS 参数。该工作包的结构示
意图和功能模块列表分别见图10.114 和表10.84。
154
辅助图像滤光片
透过率曲线
二维图像重建
WCS解算
图像配准
WCS头文件参数
图像像素坐标准
备
波长流量定标后
的数据立方
二维图像重建
WCS解算
像素坐标重构
星场识别定心
辅助图像像素
坐标准备
高分辨率
辅助图像
MCI滤光片
透过率曲线
MCI辅助图像准备
MCI辅助图像
外部参考星表
参考星表准备
测光图像配准法
M
CI 辅助定标法
图10.114 IFS 天体测量标定工作包的结构示意图
表10.84 IFS 天体测量标定工作包的功能模块列表
序号
功能模块名称
输入
输出
实现功能
1
二维图像重建
波长定标后的
数据立方，滤
光片透过率曲
线。
原数据立方的
二维图像矩阵
（后简称为
“IFS 图像”
）
数据立方的波长
方向卷积滤光片
曲线获得二维图
像
2
图像像素坐标
准备
IFS 图像
IFS 图像的参考
点坐标和相对
参考点转换后
的像素坐标
将IFS 图像像素
坐标转换到以参
考点为原点的坐
标系下并输出
3
辅助图像像素
坐标准备
辅助图像的二
维图像矩阵
辅
助
图
像
ROI( 感兴趣区
域)，参考点坐
标，相对参考
点转换后的像
素坐标
裁剪出辅助图像
的ROI 区域并将
像素坐标转换到
以参考点为原点
的坐标系下并输
出
4
像配准
IFS 图像像素坐
标，辅助图像
ROI 像素坐标
参考点偏移，
IFS 图像旋转量
将IFS 图像与辅
助图像的ROI 图
像相对应位置对
准，获得最佳配
准下的参数。
5
星场识别定星
IFS 图像，MCI
辅助图像
IFS
图像和
MCI 图像中星
识别出IFS 图像
和MCI 图像中的
155
点中心的像素
坐标列表
星点并输出其中
心坐标
6
像素坐标重构
IFS 的像素坐
标，MCI 的像
素坐标