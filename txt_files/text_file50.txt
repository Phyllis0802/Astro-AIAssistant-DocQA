N方法预估计恒星参数
恒星参数初值
模板匹配
恒星参数星表（Tef f 、
l ogg、[ Fe/ H
] 、[ a/ Fe]
等
一维光谱
一维PSF轮廓
恒星理论模板光谱库配置文
件
图像预处理：
光谱拼接
图10.79 恒星参数测量工作包流程图
表10.52 参数星表测量工作包模块列表
序号
功能模块名
称
输入
输出
实现功能
1
数据预处
理：光谱拼
接
1）粗分类恒星星表
2）GU、GV、GI 的一
维无缝光谱
3）无缝光谱PSF
拼接光谱
将同源的
GU 、GV 、
GI 的一维无
缝光谱沿波
长方向拼接
2
神经网络预
估计
上一步产生的光谱
神经网络的恒星
参数初值(有效
温度、表面重
力、金属丰度和
α丰度)
预估无缝光
谱的参数初
值
3
模板匹配
无缝光谱拼接产生的光
谱
神经网络预估计产生的
恒星参数(有效
温度、表面重
力、金属丰度和
α丰度)和相应
模板匹配得
到最佳匹配
模板的恒星
参数及误差
117
恒星参数初值
3）恒星理论光谱配置
文件
的误差
8.1.4.50 无缝光谱高精度波长定标工作包
该工作包针对仪器效应改正后的光谱图像进行分析。首先，该
工作包针对1 级无缝光谱数据，利用海量外部巡天数据开展高精度
波长定标。高精度波长定标详细过程如下：首先收集速度标准星表
并生成全波段模版谱，收集发射线点源表；然后计算速度标准星不
同波长范围速度及误差，计算不同发射线速度及误差；其次比较测
量速度与预期速度的差异，修正初始波长定标关系；最后，利用修
正后的波长定标关系，更新所有目标波长。该工作包流程图及模块
分解见图10.80（工作包编号：KSC-SJ2-PK-21），模块列表和功能
详见表10.53。
已有光谱巡天数据
收集速度标准星表并
生成全波段模板谱
收集发射线电源表
速度标准星星表
发射线天体发射线表
CSST一维光谱
计算速度标准星速度
及误差
计算不同发射线速度
及误差
不同波长范围内的速
度及误差
不同发射线速度及误
差
修正初始波长
定标关系
更新目标波长
高精度波长定标
光谱 
图10.80 高精度波长定标工作包流程图
表10.53 高精度波长定标工工作包模块列表
序号
功能模块名称
输入
输出
实现功能
1
收集速度标准星
表并生成全波段
模板谱模块
已有公开的光
谱巡天数据
速度标准星表
收集速度标准星表
并生成全波段模版
谱
2
收集发射线电源
表模块
已有公开的光
谱巡天数据
发射线天体发射
线表
收集发射线点源表
3
计算速度标准星
速度及误差模块
CSST 一维光
谱
不同波长范围内
的速度及误差
计算速度标准星不
同波长范围速度及
误差
4
计算不同发射线
速度及误差模块
CSST 一维光
谱
不同发射线速度
及误差
计算不同发射线速
度及误差
5
修正初始波长定
标关系模块
Get_RV_stars,
Get_RV_emiss
ion_line 输出
修正后的波长定
标关系
修正初始波长定标
关系
118
结果，及目标
0 级像位置
6
更新目标波长模
块
CSST 一维光
谱
波长修正后的
CSST 一维光谱
更新所有目标波长
8.1.4.51 无缝光谱高精度流量定标工作包
高精度流量定标详细过程如下：首先分不同类型恒星及数据，
收集海量流量标准星表；然后分不同情况，基于光谱/恒星参数/测光
等数据预测海量恒星相对的内秉SED；其次加入消光的影响，得到
标准星预期的真实SED；接着比较预期的SED 与初始SED 的差异，
更新3D 平场；最后更新所有目标流量。该工作包流程图及模块分
解见图10.81（工作包编号：KSC-SJ2-PK-22），模块列表和功能详
见表10.54。
图10.81 高精度流量定标工作包流程图
表10.54 高精度流量定标工作包模块列表
功能模块名称
输入
输出
实现功能
收集流量标准星模块
已有公开
巡天数据
流量标准
星表
分不同恒星类型及数
据，收集海量流量标准
星表
预测标准星SED 模块
已有公开
巡天数据
标准星内
秉SED
分情况，基于光谱/恒星
参数/测光等数据预测海
量恒星相对的、内秉
SED
计算SED 模块
标准星内
秉SED,消
光
标准星预
期的真实
SED
改正消光影响，得到预
期的真实SED
更新3 维平场模块
CSST 一维
光谱，及
Get_SED
输出结果
更新后的
3D 平场
比较预期SED 与真实
SED，更新3D 平场
更新目标流量模块
CSST 一维
更新后的
更新目标流量
已有光谱巡天数据
收集流量标准星
表
预测海量恒星相
对的内禀SED
流量标准星星表
标准星内禀SED
CSST一维光谱
消光改正
消光参数
预期的真实SED
更新三维平场
无缝光谱与多色
成像对应图像
更新目标流量
高精度流量定标
光谱 
M
CI 流量定标
结果
119
光谱，更
新后的3D
平场
目标流量
8.1.4.52 无缝光谱2 级数据可用性标记工作包
该工作包面向无缝光谱2 级科学数据，通过科学验证的方式确
定数据系统的无缝光谱2 级科学产品在数据指标，精度等方面是否
满足科学家的需求。无缝光谱2 级数据可用性标记工作包类似多色
成像2 级可用性标记工作包，其流程图见图10.51（工作包编号：
KSC-SJ2-PK-23），模块列表和功能详见表10.24。
8.2 多通道成像仪数据处理
多通道成像仪的数据处理(简称MCI)流程同为天文成像观测数
据处理，具体包括：从探测器获得的原始数字图像（0 级）进行修
正和定标，生成定标后的科学图像（1 级），然后在图像中探测天
体目标，并进行流量和形状等参数测量，最终形成可供天文学家使
用的合并图像及星表（2 级）的过程。
0 级科学数据需要利用参考数据，经过仪器效应改正转换为未
定标的1 级科学数据及数据对应的权重数据（weight data）、特征
位数据（flag data）和文件头数据（head data）。此过程主要目的是
改正光学系统、探测器芯片、电子控制等硬件设备对数据造成的污
染，与探测器选型有关。基本流程包括：偏置改正、暗场改正、平
场改正、快门效应改正、宇宙线和坏像元探测等。
完成仪器效应改正之后进入位置定标功能。此过程是利用3 块
探测器共同参与，计算得到整个靶面的物理位置与天球坐标的投影
映射。开始定标计算前，需要通过数据库获得望远镜指向及其视场
大小区域内的外部参考星表，并从未定标的1 级科学数据中探测得
到用于计算的天体，最后通过算法获得映射关系的公式。
完成位置定标后的图像数据，可以进入外部流量定标功能。此
过程是对不同探测器的图像分别进行对应滤光片波段的零点计算。
也需要通过数据库获得望远镜指向及其视场大小区域内的外部参考
星表，与1 级科学数据中探测得到的天体进行匹配，并利用算法筛
选稳定的天体并进行颜色项等修正后得到探测器的零点。结束位置
定标后的图像数据，需要经过数据质量控制模块（Quality Control：
120
QC）检查合格后，完成数据文件与文件头文件的合并，此即1 级科
学数据。
合格的1 级科学数据可以进入图像合并、相减以及星表提取功
能。此过程包括对超深场图像的超精细对齐和合并，图像相减已提
取暂现源alerts 和变源星表，以及对相关图像进行科学目标探测，
最终形成包括科学图像中所有天体信息的星表。星表中需要包括每
个目标的位置、通过不同测量方法获得的流量、点扩展函数信息、
不同模型下的星系形态和流量等。当设备正常运行后，需要阶段性
对已经完成定标的1 级和2 级数据进行并合，形成合并后的数据，
作为定期数据释放的产品。
8.2.1 主要功能
根据多通道成像仪焦面成像的特点，以及数据流水线管理的需
求，多通道成像仪数据处理流程分为0 级、1 级和2 级数据处理。
0-1 级需要具有6 个主要功能，功能列表和功能详解见表10.55。
表10.55 MCI 数据处理软件0-1 级功能列表
序号
主要功能
功能详解
1
0 级数据可用性标记
检查
检查0 级数据的科学可用性、准确性
2
探测器效应改正
利用不同类型的参考图像，改正望远镜和探测
器本身特性所造成的图像数据不均匀性
3
天测位置定标
利用已定标的星表与望远镜观测科学图像中探
测到的各个天体在探测器上的中心位置坐标进
行交叉匹配，计算图像的世界坐标框架系统
（WCS）
，将探测器上的位置映射到天球坐标
系，计算中还要考虑各个天体的自行信息
4
天体流量定标
利用已定标的星表中的星等与空间望远镜观测
科学图像中探测到的对应天体的流量计数值，
计算图像中流量计数值到星等的转换关系
5
1 级数据可用性标记
检查
检查1 级数据的科学可用性、准确性
6
单次曝光星表提取
在已经完成位置与流量定标的单次曝光科学图
像上进行完备的目标探测，利用探测星表和其
他波段观测星表对目标源进行流量和形态的精
121
确测量等
多通道成像仪数据处理流程从1-2 级，主要是科学数据产品生
成，需要具有5 个主要功能，功能列表和功能详解见表10.56。
表10.56 MCI 数据处理软件1-2 级数据处理功能列表
序号
主要功能
功能详解
1
超深场图像合并
同一天区、同一滤光片的多次曝光图像的合并
2
超深场图像星表提
取
生成合并的星表
3
图像相减
最近一次观测图像与同一天区、同一滤光片观测图
像模板相减
4
暂现源alerts
相减图像中暂现源alerts
5
变源星表
相减图像中变源的位置、多色孔径测光星等、多色
PSF 测光星等、变源光变曲线以及各参数对应的误
差
8.2.2 主要流水线组成
为实现10.2.1 节功能，根据多通道成像仪的数据结构和数据流
水线需求，以及输入和输出数据的内容，把整个多通道成像仪的数
据处理流水线设计分为0 级、1 级和2 级处理流水线，整体流水线
图如图10.82。
122
图10.82 MCI 数据处理整体流水线图
0 级处理流水线：即是图像评估流水线，首先接收到0 级数据
作为输入，进入QC0 进行0 级数据可用性标记，然后对0 级数据
图像进行图像评估，对不同的图像进行分类，最后入数据库，完成
0 级处理流水线。
1 级处理流水线：0 级处理总流水线的输出的不同类型的图像作
为1 级处理流水线的输入。1 级流水线划分为两种类型的处理流程：
（1）正常图像数据处理流程；（2）密集星场图像数据处理流程。
经过QC1，生成1 级科学图像和相关数据存入数据库。
2 级处理流水线：指数据产品生成流程，共5 条1 级处理流水
线。在完成1 级处理流水线后，触发2 级流水线，生成各类数据产
品，经过QC2，做为2 级科学数据存入数据库供科学用户使用。
多通道成像仪0 级、1 级和2 级处理流水线总共包括6 条流水
线，详细列表见表10.57：多通道成像仪0-2 级流水线列表。下面分
123
别介绍各个流水线。
表10.57 MCI 数据处理软件0-2 级流水线列表
总流水线
次级流水线
分支流水线
流水线编号
多通道成像仪0
级处理总流水线
图像评估流程
图像评估流水线
KSC-SJ5-PL0-01
多通道成像仪1
级处理总流水线
正常图像数据处
理日常流程
单幅图像处理流
水线
KSC-SJ5-PL1-01
星系团超深场图
像数据处理日常
流程
密集星场处理流
水线
KSC-SJ5-PL1-02
多通道成像仪2
级处理总流水线
数据产品生成流
程
超深场图像合并
流水线
KSC-SJ5-PL2-01
超深场星表提取
流水线
KSC-SJ5-PL2-02
图像相减流水线
KSC-SJ5-PL2-03
8.2.2.1
0 级处理流水线-图像评估流水线
0 级数据处理流水线即是图像评估流水线。在每天的观测数据
下来后，首先进行QC0 的科学可用性标记，然后立即促动图像评估