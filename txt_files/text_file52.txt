量信息
得到天体临时文件：包括
位置定标更新后的位置信
息和流量信息
2
图像天区位
置的外部参
考星表
图像中天体的
位置信息；外
部参考星表库
图像天区位
置对应的外
部参考星表
得到图像天区位置的外部
参考星表
3
筛选可用定
标源
图像中天体的
位置和流量信
息；图像天区
位置对应的外
部参考星表的
位置和流量信
息
用于定标零
点计算的参
考目标源
（位置和对
应的仪器星
等和参考星
等）
对测光星表和参考星表按
天体位置进行交叉匹配，
并对匹配源按测光质量、
星等信噪比、颜色分布等
进行筛选，得到用于定标
零点计算的参考目标源。
4
图像流量零
点的计算
用于定标零点
计算的参考目
标源（位置和
对应的仪器星
等和参考星
等）
；颜色项
和测光平场的
改正方程
单幅图像的
流量零点以
及相应的流
量定标信息
将参考目标源的测光星等
（测光平场改正后）和参
考星等（颜色项改正后）
进行比较和拟合，由此计
算得到单幅图像的流量零
点
5
图像文件头
信息更新
单幅图像的流
量零点以及相
应的流量定标
信息；位置定
标得到的图像
包含流量定
标信息和位
置定标信息
的图像头文
件
将流量定标零点和定标相
关信息添加到图像文件
头，并保存更新到额外的
图像头文件。
132
头文件
8.2.3.7
单次曝光星表提取工作包
该工作包负责在完成定标后的单次曝光图像上对天体目标源进
行探测，并对这些目标源进行各种类型的测光，最终获得单次曝光
科学图像星表。这一过程主要包括了如下数据分析过程：天光背景
估计、目标探测、点扩散函数建模、目标形态测量、测光分析（包
括孔径测光、PSF 测光和模型测光等）和恒星/星系分类等。单次曝
光星表提取工作包的流程图10.93（工作包编号：KSC-SJ5-PK-07），
模块列表和功能详见表10.62。
图10.93 MCI 单次曝光星表提取工作包流程图
表10.62 MCI 单次曝光星表提取工作包模块列表
序号
功能模块名
称
输入
输出
实现功能
1
天光背景估
计
定标后的图
像，权重图
像和标记图
像
天光背景图
像和天光背
景起伏图像
通过二次天光估计的方法
获得天光背景图像
2
目标探测
定标后的图
像，权重图
像和标记图
像，天光背
景和起伏图
像
探测目标的
位置和基本
测量信息
对单波段图像进行目标探
测并测量基本的目标信息
3
PSF 建模
PSF 星的截
取图像
空间变化的
PSF 模型
选取合适的PSF 星，进行
PSF 建模构建空间变化的
PSF 模型
133
4
孔径测光
扣除天光后
的图像，权
重图像，
mask 图像
圆孔径测光
信息
根据目标探测结果在图像
上进行圆孔径测光。
5
Kron 孔径测
光
扣除天光后
的图像，权
重图像，
mask 图像
Kron 孔径测
光信息
根据目标探测结果在图像
上进行Kron 孔径测光。
6
PSF 测光
扣除天光后
的图像，权
重图像，
mask 图像和
PSF 模型
PSF 测光信
息
根据目标探测结果在图像
上进行PSF 测光。
7
模型测光
扣除天光后
的图像，权
重图像，
mask 图像和
PSF 模型
模型测光信
息
根据目标探测结果在图像
上进行各种模型测光
8
单图像恒星
星系分类
单波段测光
星表
恒星星系分
类后的星表
利用单波段测光测量结果
给出恒星星系分类
8.2.3.8
超深场图像合并工作包
该工作包负责超深场同一天区、同一滤光片的多次曝光图像的
合并。超深场图像合并工作包的流程图见图10.94（工作包编号：
KSC-SJ5-PK-08），模块列表和功能详见表10.63。
图10.94 MCI 超深场图像合并工作包流程图。
表10.63 MCI 超深场图像合并工作包模块列表
序号功能模块
名称
输入
输出
实现功能
1
超深场图
像对齐
单次曝光图像
单次曝光图像
位置
图像对齐
134
2
超深场图
像合并
单次曝光图像
超深场图像
生成超深场图像
8.2.3.9
超深场星表提取工作包
该工作包负责在生成超深场合并图像之后提取超深场星表，并
进行多波段恒星、星系分类。合并星表提取工作包的流程图见图
10.95（工作包编号：KSC-SJ5-PK-09），模块列表和功能详见表
10.64。
图10.95 MCI 合并星表提取工作包流程图
表10.64 MCI 合并星表提取工作包模块列表
序号功能模块
名称
输入
输出
实现功能
1
单波段星
表合并
单次曝光测光
星表
单波段合并星
表
合并单波段的测光测量形
成更深的单波段合并星表
2
多波段星
表合并
单波段合并星
表
多波段合并星
表
合并多波段的测光信息
3
多波段恒
星、星系
分类
多波段合并星
表
目标分类后的
多波段合并星
表
利用多波段的测量信息，
形成多波段的分类合并星
表
8.2.3.10 图像相减工作包
该工作包负责最近一次观测图像与同一天区、同一滤光片观测
图像模板相减。图像相减工作包的流程图见图10.96（工作包编号：
KSC-SJ5-PK-10），模块列表和功能详见表表10.65。
图10.96 MCI 图像相减工作包流程图
表10.65 MCI 图像相减工作包模块列表
135
序号功能模块
名称
输入
输出
实现功能
1
基准图像
生成
单次曝光图像
基准图像
生成基准图像
2
单次图像
对齐基准
图像
单次曝光图像
单次曝光图像
位置
单次图像对齐基准图像
3
图像相减
单次曝光图像
相减图像
生成相减图像和移动天体
星表
8.2.3.11 暂现源alerts 工作包
该工作包负责生成暂现源alerts。暂现源alerts 工作包的流程图
见图10.97（工作包编号：KSC-SJ5-PK-11），模块列表和功能详见
表10.66。
图10.97 MCI 暂现源alerts 工作包流程图
表10.66 MCI 暂现源alerts 工作包模块列表
序号功能模块
名称
输入
输出
实现功能
1
暂现源生
成
相减图像/基准
图像
暂现源alerts
基于相减图像和基准图像
得到暂现源alerts
8.2.3.12 变源星表提取工作包
该工作包负责生成变源星表。变源星表提取工作包的流程图见
图10.98（工作包编号：KSC-SJ5-PK-12），模块列表和功能详见表
表10.67。
136
图10.98 MCI 变源星表工作包流程图
表10.67 MCI 变源星表工作包模块列表
序号功能模块
名称
输入
输出
实现功能
1
相减图像
星表提取
相减图像
相减图像星表
基于相减图像提取星表
2
变源星表
提取
相减图像星表/
单次曝光图像
星表
变源星表
提取变源星表
8.2.3.13 MCI 的2 级数据可用性标记工作包
该工作包面向MCID 2 级科学数据，通过科学验证的方式确定
数据系统的MCI 的2 级科学产品在数据指标，精度等方面是否满
足科学家的需求。MCI 的2 级数据可用性标记工作包类似多色成像
2 级可用性标记工作包，其流程图见图10.51（工作包编号：KSC-
SJ5-PK-13），模块列表和功能详见表10.24。
8.3 积分视场光谱仪数据处理
8.3.1 主要功能
根据积分视场光谱仪（以下简称IFS）的观测模式以及数据流
水线管理的需求，IFS 的数据处理流程分四级：零级数据准备，一级
单次处理、一级多次合成、二级数据处理。
其中，零级数据可用性标记具有2 个主要功能，详见表10.68。
一级单次处理具有11 个主要功能，详见表10.69。一级多次合成具
有6 个主要功能，详见表10.70。二级数据处理具有7 个主要功能，
详见表10.71。
表10.68 IFS 数据处理软件零级数据准备功能列表
序号
主要功能
功能详解
137
1
0 级数据可用性
检查
检查0 级数据的科学可用性、准确性
2
0 级数据分类和
标记
对0 级数据进行分类，提取标签，写入数据库
表10.69 IFS 数据处理软件单次曝光处理功能列表
序号
主要功能
功能详解
1
数据合并
对同一类型的参考图像（如bias，平场，定标灯
谱等）的多次观测进行数据合并
2
探测器效应改正
利用不同类型的参考图像，改正望远镜和探测器
本身特性所造成的图像数据不均匀性
3
宇宙线扣除
搜寻图像中的宇宙线，并进行标记（mask）
4
光谱成像位置追
踪
利用平场图像追踪32 条slicer 在CCD 上的色散
后的成像位置；
5
光谱提取
依据光谱追踪的定位结果，对slicer 边缘效应进行
修正，并依据用户需求切分成多条光谱。
6
像元-波长对应关
系
搜寻定标灯谱线，并与定标灯灯谱的实验室波长
匹配，确定像元位置与波长的对应关系
7
波长定标
依据像元-波长对应关系，对抽谱所得的每个数据
行进行波长定标
8
流量定标
利用流量标准星进行流量定标
9
LSF 提取
通过观测定标灯灯谱，提取和测量谱线扩展函数
（LSF）
。
10
天体测量解算
利用MCI 伴随图像或者IFS 图像进行单次曝光视
场的天体测量解算
11
单次处理数据立
方生成
依据空间位置，将红蓝两端的数据进行拼接，生
成光谱数据立方（datacube）
；质量检查，数据库
索引。
表10.70 IFS 数据处理软件一级多次合成功能列表
序号
主要功能
功能详解
1
单次曝光数据读
取与检查
单次曝光数据读入并检查数据类型以及科学可用
性、准确性
2
多次曝光合成天
测定标
将单次曝光的图像坐标和天体测量坐标进行映
射，构建存储合并数据立方的空间，并给出新空
间的天测信息
3
光谱叠加与合成
进行数据可用性二次检查，经过二次检查后，给
出叠加后的数据立方
4
天光背景扣除
结合天光背景模型，扣除天光背景
138
5
协方差矩阵计算
给出不同像素不同波长之间的协方差，并进行压
缩
6
合成数据立方生
成及可用性标记
将叠加后的数据立方打包生成fits 文件并标记可
用性
表10.71 IFS 数据处理软件二级数据处理功能列表
序号
主要功能
功能详解
1
数据立方可用性检查
检查数据立方的科学可用性、准确性
2
数据立方光谱质量检
验
检验观测光谱和科学需求相关的参数分布是否
满足要求并给出使用建议
3
积分视场光谱的分区
叠谱
根据光谱质量和科学需求对空间像素进行合并
叠谱以提高信噪比
4
积分光谱的发射线特
征测量
对光谱的各发射线做流量等参数的测量
5
积分视场光谱的运动
学特征测量
测量光谱中发射线和吸收线的各运动学参数
6
积分视场光谱的星族
测量
通过星族分析得到各空间像素对应的年龄、金
属丰度、尘埃消光、恒星质光比等
7
科学数据包的生成
生成包含完整科学参数的数据包，并对每个参
数作出解释，通过可用性检查确保各参数有效
8.3.2 流水线组成
为实现IFS 数据处理软件所列功能，根据数据流水线需求，需
要将IFS 的数据处理流水线设计分为0 级数据准备、单次曝光处理、
多次曝光合成和二级数据处理流水线，整体流水线图见图10.99。
139
I FS0级数据
准备
IFS 0级数据
I FS单次曝光
处理流水线
I FS多次曝光
合成流水线
I FS二级数据
处理流水线
数据库
（IFS多次合
成数据立方）
数据库
（IFS二级数
据）
数据库
（IFS单次曝
光数据立方）
数据库
（IFS 0级数
据）
图10.99 IFS 数据处理整体流水线示意图
IFS 0 级数据准备流水线：首先接收到一组0 级数据作为输入，
进入QC0 进行0 级数据可用性标记并进行分类（图像数据和参考
数据），读取数据标签，存入数据库。
IFS 单次曝光处理流水线：从数据库读入可处理的单次曝光的
0 级数据和相应的参考文件数据，对单次曝光的0 级数据图像进行
流水线处理，处理结果进行质量标记，并存入数据库，完成0 级处
理流水线。
IFS 多次曝光合成流水线：从数据库读入某科学目标的一组单