的参考图像
参考图像进行建模以消
除随机效应对图像的影
响
8.4.3.3
仪器效应改正工作包
该工作包是针对0 级数据图像，利用各种参考图像（坏像元，
偏置，平场，暗场等）文件，对0 级科学图像进行一系列的仪器效
应改正。详细过程如下：首先进行电荷转移噪声处理，然后数据
CCD 信息和坏点信息，进行坏点标记。然后进行overscan 和bias
处理。对饱和点进行检测标记后，输入dark 和flat 辅助图像，进行
暗电流和平场改正，最后通过非线性系数文件进行非线性改正。工
作包流程及模块分解流程图见图10.131（工作包编号：KSC-SJ7-
PK-03），模块列表和功能详见表10.103。
0级数据图像
电子转移噪
声改正
Overscan改
正
1级图像、坏
点标记、饱
和点标记
坏点和各数
据区域标记
C
TE改正系数
C
C
D信息、
坏点信息
Bias改正
Bias参考辅
助图像
饱和点标记
暗电流改正
平场改正
Dark参考图
像
Flat参考图像
非线性改正
非线性系数
图10.131 仪器效应改正工作包
表10.103 仪器效应改正工作包模块及功能列表
序号
功能模块名称
输入
输出
实现功能
1
电子转移噪声改正
0 级数据图像
电子转移噪声改
正后图像
电子转移噪
声改正
2
坏点和各数据区域标
记
CCD 信息、
坏点信息
坏点标记图、各
数据区域标记图
标记坏点和
个各数据区
域
172
3
Overscan 改正
电子转移噪声
改正后图像、
各数据区域标
记图
Overscan 改正后
的图像
Overscan 改
正
4
Bias 改正
Overscan 改正
后的图像、
Bias 参考图像
Bias 改正后的图
像
Bias 改正
5
饱和点标记
Bias 改正后的
图像
Bias 改正后的图
像、饱和点标记
标记图像中
的饱和位置
6
暗电流改正
Bias 改正后的
图像，dark 参
考图像
暗电流改正后的
图像
对图像进行
暗电流改正
7
平场改正
暗电流改正后
的图像、flat
参考图像
平场改正后的图
像
对图像进行
平场改正
8
非线性改正
平场改正后的
图像、非线性
改正系数
非线性改正后的
图像
对图像进行
非线性改正
8.4.3.4
观测效应处理工作包
该工作包是针对经过仪器效应修正后的图像，进行天空背景和
宇宙线等环境效应处理。详细过程如下：首先对科学图像进行背景
的扣除，最后对宇宙线的位置进行标记。工作包流程及模块分解流
程图见图10.132（工作包编号：KSC-SJ7-PK-04），模块列表和功
能详见表10.104。
0.5级数据图像
宇宙线标记
0.9级图像数据、
mask数据
背景处理
背景参考图像
图10.132 观测效应改正工作包
表10.104 观测效应处理工作包模块及功能列表
序号
功能模块名称
输入
输出
实现功能
1
背景处理
仪器修正后的
图像、背景参
考图像
扣除背景后的图
像
背景修正
2
宇宙线标记
扣除背景后的
数据图像、宇宙
根据图像信
173
数据图像
线标记数据
息进行宇宙
线标记
8.4.3.5
1 级数据生成工作包
该工作包根据星冕仪1 级数据fits 头定义、数据结构定义、文
件命名规范，生成参考图像、科学图像、MASK 图像等星冕仪1 级
图像。处理过程中还涉及到对fits 头文件中部分条目进行计算。工
作包流程及模块分解流程图见图10.133（工作包编号：KSC-SJ7-
PK-05），模块列表和功能详见表10.105。
0.9级数据图像
0.9级参考图像
头文件内容计算
参考图像
科学图像
Mask图像
fits文件生成
fits头定义
数据结构定义
文件命名规范
图10.133 级数据生成工作包
表10.105 1 级数据生成工作包模块及功能列表
序号
功能模块名称
输入
输出
实现功能
1
头文件内容计算
仪器效应修正
及观测效应修
正后的科学图
像及参考图像
Fits 头文件
计算数据图
像或参考图
像头文件中
的相关信息
2
Fits 文件生成
Fits 头文件
图像数据
1 级数据图像、
mask 图像或1
级参考图像
根据定义生
成1 级产品
8.5 太赫兹模块数据处理
太赫兹模块数据处理过程是一个将太赫兹模块产生的原始数据
逐级处理为0 级数据、1 级数据和2 级数据，最终生成标准的FITS
数据文件的过程。在此过程中，数据处理涉及数据组包、强度校准、
频率和位置修正、网格重整（仅针对OTF 观测数据）、数据质量检
查和FITS 文件生成等子任务。
174
8.5.1 主要功能
根据中国空间站巡天望远镜工作特点，以及数据流水线管理的
需求，太赫兹模块数据处理流程分为0 级、1 级和2 级。0 和1 级
具有如表10.106。
表10.106 太赫兹模块数据处理系统0、1 级处理功能列表
序号
主要功能
功能详解
1
0 级数据可用性
标记检查
检查0 级数据的科学可用性、准确性
2
数据组包
将太赫兹模块频谱处理组件（硬件）产生的数据
依据0 级数据定义以及观测任务文件的说明，将
频谱数据拆包存储的数据进行重新组包，并加入
时间戳，生成完整观测频谱0 级数据。
3
强度校准
基于斩波轮校准方法进行谱线强度校准，需要对
强度校准因子进行分析
4
频率和位置修正
依据卫星同目标的相对运动及姿态参数，修正观
测谱线频率的多普勒频偏，并确定每一条谱线对
应的天球坐标位置
5
网格重整
在OTF 观测模式下观测数据需要进行网络重整，
使之成为空间均匀采样的成图谱线数据文件
2 级处理是对生成的1 级数据进行质量检查，并按照标准的
FITS 格式生成2 级数据。2 级处理的功能列表见表10.107。
表10.107 太赫兹模块数据处理系统2 级功能列表
序号
主要功能
功能详解
1
数据质量检查
检查1 级数据的准确性，对谱线数据中噪声异常
数据或存在干扰数据进行标记
2
FITS 文件生成
对校准后符合数据质量要求生成标准FITS 文件
8.5.2 主要流水线组成
为实现7.6.1 节所提到的功能，根据太赫兹模块数据结构和数
据流水线需求，拟将整个太赫兹模块数据处理流水线设计分为0 级、
1 级和2 级处理流水线，整体流水线框图如图10.134 所示。
175
太赫兹模块
原始数据
Q
C0
0级处理流水线
数据库
（0级数据）
数据组包
强度校准
频率位置校准
网格重整
数据质量检查
FI TS文件生成
单点观测模式数据处理流水线
（1级处理流水线）
O
TF观测模式数据处理流水线
（1级处理流水线）
强度校准
频率位置校准
数据库
（1级数据）
单点观测模式数据处理流水线
（0级处理流水线）
数据库
（2级数据）
图10.134 太赫兹模块数据处理流水线图
太赫兹模块数据处理0 级，1 级，2 级流水线包括了5 条流水
线，详细列表见表10.108，下面分别介绍各流水线。
表10.108 太赫兹模块各级流水线汇总表
总流水线
次级流水线
分支流水线
流水线编号
太赫兹模块0 级
处理总流水线
0 级数据处理
0 级处理流水线
KSC-SJ8-PL0-01
太赫兹模块1 级
处理总流水线
单点观测模式数
据处理日常校准
流程
1 级处理流水线
KSC-SJ8-PL1-01
太赫兹模块2 级
处理总流水线
数据质量检查与
FITS 文件生成
2 级处理流水线
KSC-SJ8-PL2-01
8.5.2.1
0 级处理流水线
0 级数据处理流水线需要实现：1.对太赫兹模块硬件产生的原始
数据进行初步标记；2.按照观测的log 文件以及观测任务文件对原
始数据进行重新组包，并加入时间戳，生成完整观测频谱0 级数据。
太赫兹模块0 级处理流程图见图10.135（流水线编号：KSC-SJ8-
PL0-01）。
176
太赫兹模块
原始数据
Q
C0
0级处理流水线
数据库
（0级数据）
数据组包
观测l og文件，
时间戳
图10.135 太赫兹模块0 级处理流程图
8.5.2.2
1 级处理流水线
1 级数据处理流水线需要实现对0 级数据的校准。根据太赫兹
模块观测模式的不同可分为单点观测和OTF 观测。单点观测是针对
点源目标进行成像，需要对成像数据的强度、频率和位置进行校准。
OTF 观测模式是针对区域目标进行观测。在太赫兹模块进行OTF
观测时，需要通过控制天线波束指向按照指定的观测路径对目标区
域内的样点逐个进行快速扫描观测。在此模式下观测数据不仅要进
行强度、频率和位置的校准，而且还需要进行网格重整来消除OTF
模式下空间采样数据的非均匀性，因此太赫兹模块1 级处理流程图
见图10.136。（流水线编号：KSC-SJ8-PL1-01）。
强度校准
频率位置校准
网格重整
单点观测模式数据处理流水线
（1级处理流水线）
O
TF观测模式数据处理流水线
（1级处理流水线）
强度校准
频率位置校准
数据库
（1级数据）
太赫兹模块
0级数据
观测模式
判断
图10.136 太赫兹模块1 级处理流程图
8.5.2.3
2 级处理流水线
2 级数据处理流水线需要实现对1 级数据的质量进行检查，将
数据中噪声异常数据或存在干扰数据进行标记，并且将校准后符合
177
数据质量要求的数据按照标准的FITS 文件定义生成标准FITS 文件。
因此，太赫兹模块2 级处理流程图见图10.137。（流水线编号：
KSC-SJ8-PL2-01）
图10.137 太赫兹模块2 级处理流程图
8.5.3 主要工作包
根据上述数据处理流水线的结构和数据流方向，可以把流水线
分解为下面9 个主要工作包单元，分别是0 级数据处理流水线包括
2 个工作包单元；1 级数据处理流水线包括4 个工作包单元；2 级数
据处理流水线包括3 个工作包单元。详见表10.109 所示。各个流水
线工作包简要叙述如下：
表10.109 太赫模块数据处理工作包
序号
工作包名称
工作包编号
1
0 级数据可用性标记工作包
KSC-SJ8-PK-01
2
0 级数据组包工作包
KSC-SJ8-PK-02
3
单点观测模式下1 级数据强度校准工
作包
KSC-SJ8-PK-03
4
单点观测模式下1 级数据频率和位置
校准工作包
KSC-SJ8-PK-04
5
OTF 观测模式下1 级数据强度校准工
作包
KSC-SJ8-PK-05
6
OTF 观测模式下1 级数据频率和位置
校准工作包
KSC-SJ8-PK-06
7
1 级数据网格重整工作包
KSC-SJ8-PK-07
8
1 数据质量检查工作包
KSC-SJ8-PK-08
9
2 级数据的FITS 文件生成工作包
KSC-SJ8-PK-09
数据质量检查
FI TS文件生成
单点观测模式数据处理流水线
（2级处理流水线）
数据库
（2级数据）
太赫兹模块
1级数据
178
8.5.3.1
0 级数据可用性标记工作包
对太赫兹硬件模块输出的原始数据进行质量检查。核查输出的
原始文件中关键字段的取值范围，若各字段取值均在预先设定的范
围内则标记0 级数据可用，反之，标记不可用。0 级数据可用性标
记工作包流程图及模块分解见图10.138（工作包编号：KSC-SJ8-
PK-01），模块列表和功能见表10.110。
太赫兹模块
原始数据
数据质量检查
0级处理可用性标记工作包
关键字段取值
是否合格
0级数据可用
合格
0级数据不可用
不合格
图10.138 太赫兹模块0 级数据可用性标记工作包
表10.110 太赫兹模块0 级数据可用性标记工作包模块列表
序号
功能模块名称
输入
输出
实现功能
1
0 级数据质量检
查
模
块
（QC0）
太赫兹模
块原始数
据
带有质量标
记的0 级数
据
对原始的0 级数据进行质
量判断，并标志合格状态
8.5.3.2
0 级数据组包工作包
将太赫兹模块频谱处理组件（硬件）产生的数据依据设定的0
级数据定义以及观测任务文件中关键字段的说明，将频谱数据拆包
存储的数据进行重新组包，并加入时间戳，生成完整观测频谱0 级
数据。0 级数据组包工作包流程图及模块分解见图10.139（工作包
编号：KSC-SJ8-PK-02），模块列表和功能见表10.111。