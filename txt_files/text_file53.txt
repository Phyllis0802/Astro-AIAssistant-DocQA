次曝光的经过单次曝光处理流水线处理的数据立方作为输入,进行多
次曝光合成的流水线处理，处理生成多次合成的数据,经过质量标记，
存入数据库。
IFS 二级数据处理流水线：从数据库读入单个或者一批科学目
标的经过多次曝光合成后的数据立方，经过二级数据处理流水线处
理，生成单个或者一批科学目标的二级数据产品，经过质量标记后
存入数据库。
140
以上四条流水线的名称及编号见表10.72。
表10.72 IFS 数据处理软件的流水线列表
处理流程类别
流水线名称
流水线编号
0 级数据准备
IFS 0 级数据准备流水线
KSC-SJ6-PL0-01
生成单次曝光
的积分视场光
谱
IFS 单次曝光处理流水线
KSC-SJ6-PL1-01
生成科学目标
的合成积分视
场光谱
IFS 多次曝光合成流水线
KSC-SJ6-PL1-02
生成科学目标
的二级科学数
据
IFS 二级数据处理流水线
KSC-SJ6-PL2-01
8.3.2.1
IFS 0 级数据准备流水线
IFS 0 级数据准备流水线主要完成两个工作包，QC0 检验和图像
数据入库。QC0 检验首先进行校验码校验，然后进行0 级数据的科
学可用性标记，即对图像数据的主要参数和次要参数做检验，然后
进行标记。在图像数据完成可用性标记后，提取图像关键参数信息
进行索引标识后进行数据入库。0 级数据处理流水线的结构示意图
见图10.100（流水线编号：KSC-SJ6-PL0-01）。
QC0检验
图像参数标识
数据库
（0级数据）
0级数据图像
图10.100 IFS 0 数据准备流水线结构示意图
8.3.2.2
IFS 单次曝光处理流水线
IFS 单次曝光处理流水线首先从数据库获取一组具有科学可用性
的单次曝光的原始图像（含科学图像及参考图像），经过仪器效应
改正之后，产生一批预备文件。其后，利用平场观测追踪所有切片
色散后在CCD 上的成像位置，截取出32 条切片的光谱带。对切片
边缘效应进行修正后，依据用户的空间分辨率需求将光谱带切分成
多条光谱，生成目标源的光谱文件。接下来，利用定标灯观测确定
每根光谱像元位置与波长的对应关系（PTOW 关系），对目标源的
每根光谱进行波长定标，并可依据用户需求进行重新波长采样。然
141
后，对光谱进行宇宙线扣除，利用流量标准星对目标源进行流量定
标。再下来，依据光谱的空间排列位置，将光谱文件转换为数据立
方（datacube），并对红蓝两端的数据立方进行误差加权拼接，生成
全波段数据立方。此后，解算单次曝光的天体测量信息，最后，进
行质量检测和数据索引，形成可入库的单次曝光数据立方。
IFS 单次曝光处理流水线的结构示意图见图10.101（流水线编号：
KSC-SJ6-PL1-01）。
0级单次曝光
正常图像
仪器效应改正
波长定标
光谱成像位置
追踪
光谱抽取
求解
像元-波长对
应关系
流量定标
天体测量定标
单次处理数据
立方生成及可
用性标记
Bias图像
数据库
IFS
单次曝光
数据立方
改正后的单次
曝光科学图像
单次曝光
数据立方
S
licer成像位置
文件
0级平场
正常图像
0级定标灯
正常图像
像元波长对应
关系参数文件
定标灯实验室
波长文件
宇宙线扣除
0级Bias
正常图像
数据合并
坏点等辅助文
件
数据合并
改正后的
平场图像
改正后的
定标灯图像
数据合并
外部图像
和星表等
光谱抽取
S
licer成像位置
文件
标准星
本征光谱
卫星轨道运行
参数
图10.101 IFS 单次曝光处理流水线的结构示意图
8.3.2.3
IFS 多次曝光合成流水线
该流水线的整体框架流程图见图10.102（流水线编号：KSC-
SJ6-PL1-02）。
142
数据库
IFS
单次曝光
数据
多次曝光合成天测
定标
叠加图像天体测量
信息
图像叠加
Fits文件创建
误差和协方差计算
叠加图像流量及可
用性数据立方
叠加图像误差数据
立方
数据库
IFS
多次曝光
合成数据
DR
P数据
天光背景扣除
天光背景模型
数据读取与整体可
用性检查
图10.102 IFS 多次曝光合成流水线的结构示意图
该流水线首先从数据库读取单个或者一组科学目标的一组单次
曝光的一级光谱数据立方，经过数据读取评估工作包，判断是否可
以用于多次合成。后续流程包括：首先进行天体测量定标，完成单
次曝光图像坐标锚定，合成图像空间创建以及合成图像天体测量信
息的输出；随后进行图像叠加将单次曝光图像映射到合成图像中；
再结合天光背景模型，进行天光背景扣除；最后经过误差计算工作
包，给出误差估计和协方差的压缩数据。以上所有工作包产生的有
效数据经过FITS 文件创建工作包，打包成以科学目标为索引的多
次曝光合成的一级光谱数据，经过质量检测和数据库索引后存入数
据库。
8.3.2.4
IFS 二级数据处理流水线
IFS 二级数据处理流水线主要包含两大部分：1）光谱质量检验，
和2）光谱科学参数提取。在光谱质量检验环节，首先检查各流量、
误差等数据是否为有效值，其次检查光谱信噪比等分布以及误差估
计准确度，若存在问题，则反馈给0 级和1 级数据处理环节做修正。
若数据正常，则进入光谱的科学参数提取环节。首先根据科学要求
设定信噪比，并对空间合并像素做光谱叠加；其次，针对满足信噪
比要求的光谱做吸收线拟合，得到恒星的运动学参数、气体对应的
发射线流量和运动学参数、以及星族相关的年龄、金属丰度、尘埃
消光、恒星质光比等参数。最后，将得到的各科学参数输出成IFS
143
科学数据包存储。数据包不仅包含各科学参数，同时匹配相关的数
据说明，以方便用于科学分析。流水线图如图10.103（流水线编号：
KSC-SJ6-PL2-01）。
图10.103 IFS2 级数据处理流水线的结构示意图
8.3.3 主要工作包
根据上述IFS 数据处理流水线的结构和数据流方向，可以把四
条IFS 数据流水线分解为下面25 个主要工作包单元，分别是：0 级
数据准备流水线包括2 个工作包单元；单次曝光处理流水线包括
11 个工作包单元；多次曝光合成流水线包括6 个工作包单元；二级
数据处理流水线包括6 个工作包单元。相关工作包名称及编号见表
10.73。下面对各个工作包进行工作模块的分解及功能说明。
表10.73 IFS 数据处理软件的工作包列表
序号
工作包名称
工作包编号
1
IFS 0 级数据可用性标记工作包
KSC-SJ6-PK-01
2
IFS 0 级数据索引标识工作包
KSC-SJ6-PK-02
3
IFS 参考数据准备工作包
KSC-SJ6-PK-03
4
IFS 探测器效应改正工作包
KSC-SJ6-PK-04
144
5
IFS 宇宙线扣除工作包
KSC-SJ6-PK-05
6
IFS 光谱成像位置追踪工作包
KSC-SJ6-PK-06
7
IFS 光谱提取工作包
KSC-SJ6-PK-07
8
IFS 像元-波长对应关系工作包
KSC-SJ6-PK-08
9
IFS 波长定标工作包
KSC-SJ6-PK-09
10
IFS 流量定标工作包
KSC-SJ6-PK-10
11
IFS LSF 提取工作包
KSC-SJ6-PK-11
12
IFS 天体测量标定工作包
KSC-SJ6-PK-12
13
IFS 单次处理数据立方生成工作包
KSC-SJ6-PK-13
14
IFS 多次曝光数据可用性工作包
KSC-SJ6-PK-14
15
IFS 多次曝光合成几何框架工作包
KSC-SJ6-PK-15
16
IFS 多次曝光图像叠加工作包
KSC-SJ6-PK-16
17
IFS 天光背景扣除工作包
KSC-SJ6-PK-17
18
IFS 多次曝光合成误差估算工作包
KSC-SJ6-PK-18
19
IFS 多次曝光合成文件生成工作包
KSC-SJ6-PK-19
20
IFS 一级合成数据质量检查工作包
KSC-SJ6-PK-20
21
IFS 数据立方空间像素合并工作包
KSC-SJ6-PK-21
22
IFS 积分光谱的吸收线测量工作包
KSC-SJ6-PK-22
23
IFS 积分光谱的发射线测量工作包
KSC-SJ6-PK-23
24
IFS 积分光谱的星族分析工作包
KSC-SJ6-PK-24
25
IFS 二级数据生成工作包
KSC-SJ6-PK-25
8.3.3.1
IFS 0 级数据可用性工作包
该工作包（编号：KSC-SJ6-PK-01）针对数据中心提供的0 级
数据图像，用途是保证观测获得数据的科学上的可用性。
该工作包主要包含三个功能模块，分别为：主要参数检查模块，
次要参数检查模块，导星数据模块。所有的0 级数据入库之前图像
都会先执行QC0 进行标记，进行标记后生成数据检查报告列表和辅
助头文件返回到数据库中。该工作包流程图类似多色成像0 级数据
可用性标记工作包流程图，见图10.34，模块列表和功能详见表10.7。
145
8.3.3.2
IFS 0 级数据索引标识工作包
该工作包（编号：KSC-SJ6-PK-02）针对可用性标记处理流水
线之后的QC0 级数据图像,内容是对图像进行关键参数提取和数据
库索引，为下一步数据处理流水线提供数据文件的索引功能。该工
作包中，主要包含一个功能模块：关键参数标识模块。该工作包的
结构示意图和功能模块列表分别见图10.104 和表10.74。
图像参数标识
数据库
（0级数据）
QC0级数据图像
图10.104
IFS 0 级数据索引标识工作包的结构示意图
表10.74 IFS 0 级数据索引标识工作包的功能模块列表
序号
功能模块名称
输入
输出
实现功能
1
图像关键参数标
识
QC0 级数据
图像关键
参数标识
列表
提取0 级数据图像关
键信息，并进行数据库
索引。
8.3.3.3
IFS 参考数据准备工作包
该工作包（编号：KSC-SJ6-PK-03）根据目标观测条件向数据
库索取指定时间段内的参考数据的观测图像，并进行数据合并，从
而减小误差及噪声影响，得到可用于数据处理的bias、平场、定标
灯参考图像，并存入数据库。该工作包结构示意图见图10.105，其
功能模块列表见表10.75。
0级bi as图像
数据合并
Bi as图像
数据库
0级f l at 图
像
数据合并
Fl at 图像
数据库
146
0级定标灯
图像
数据合并
定标灯图像
数据库
图10.105 IFS 参考数据准备工作包的结构示意图
表10.75 IFS 参考数据准备工作包中的功能模块列表
序号
功能模块名称
输入
输出
实现功能
1
数据合并
0 级正常数据
（bias ，平
场，定标灯
等）
合并后的参考
图像
对多次观测的参考
数据进行合并，减
小噪声及误差。
8.3.3.4
IFS 仪器效应改正工作包
该工作包（编号：KSC-SJ6-PK-04）是针对0 级数据图像，利
用各种参考图像（偏置、平场、暗场、坏像元等）文件，改正望远
镜和探测器本身特性所造成的图像数据不均匀性。首先，对0 级数
据图像进行bias、暗电流改正，然后标记坏点，做CTE 效应改正，
接着输入辅助图像Flat 图像进行Flat 改正，最后对可能干扰条纹进
行探测并改正，得到改正后科学图像。该工作包的结构示意图和功
能模块列表分别见图10.106 见表10.76。
0级数据图像
Bias、dark扣
除
Bias观测等
辅助文件
改正后的
科学图像
坏点标记
C
TE效应改正
Flat改正
卫星干扰条纹
探测及改正
坏点文件
Flat观测等
辅助文件
仪器效应改正工作包
图10.106 IFS 仪器效应改正工作包的结构示意图
表10.76 IFS 仪器效应改正工作包的功能模块列表
序号
功能模块名称
输入
输出
实现功能
1
Bias、dark 扣除
0 级正常数据，合
并后的Bias 观测等
辅助文件
扣除bias、
dark 后的图
像
扣除图像中的
bias、暗电流的
影响
2
坏点标记
上一步产生的图
像，坏点记录文件
标记坏点后
的图像
依据坏点记录文
件，在mask 层
147
标记坏点位置
3
CTE 效应改正
上一步产生的改正
图像
CTE 改正后
的图像