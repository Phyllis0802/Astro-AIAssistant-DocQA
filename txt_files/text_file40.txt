多色图像0级处理流水线
无缝光谱
0级处理流水线
Q
C0
I
I I
天
区
标
志
1. 低密度天区
2. 中密度天区
3. 高密度天区
1. 近邻可
分解星系
2. 近邻
大星系
3. 星
云区
4. 已知
星系团
5. 饱和污
染图像
1级处理流水线
I 3
I 3+I I 1
I I 2
I I 3
I I 4
I I 5
I 1
I 3
I 2
0. 正常
天区
I I 0
多色
成像
2+级
流水
线
（科
学团
队）
无缝光谱2+级流水
线（科学团队）
高精
度流
量定
标流
水线
图10.3 巡天模块数据处理总流水线图
45
巡天模块0 级处理流水线：首先将运控中心下传的0 级数据图
像作为输入，经过数据类型判断后，如果为多色成像数据的图像将
进行多色成像0 级数据图像可用性标记，然后对多色成像0 级数据
图像进行图像评估，根据多测成像和天测数据处理对于图像的不同
要求，对不同的成像图像进行分类，称为多色成像0 级数据处理流
水线；如果为无缝光谱数据的图像将进行无缝光谱0 级数据图像可
用性标记，然后对无缝光谱0 级数据图像进行图像评估，对不同的
图像进行分类，成为无缝光谱0 级数据处理流水线；最后将完成图
像评估的数据入库，共包含2 条次级流水线。
巡天模块1 级处理流水线：巡天模块0 级处理流水线输出的不
同类型的图像作为1 级处理流水线的输入。1 级流水线按日常处理
流水线和特殊图像处理流水线划分。1 级流水线根据功能不同划分
为3 种类型：多色成像1 级数据处理流水线，共包含7 条流水线；
天体测量1 级数据处理流水线，共包含4 条流水线；无缝光谱1 级
处理流水线，共包含3 条流水线。然后经过QC1，生成1 级科学
图像和相关数据存入1 级数据库。一共包含14 条1 级流水线。
巡天模块2 级处理流水线：巡天模块2 级处理流水线将读取1
级处理流水线的结果作为输入，最后输出数据产品。2 级处理流水
线划分为3 种类型的处理流水线：多色成像2 级数据处理流水线，
共包含7 条流水线；天体测量2 级数据处理流水线，共包含3 条流
水线；无缝光谱2 级处理流水线，共包含4 条流水线，生成各类数
据产品，然后经过QC2 得到2 级科学数据，作为2 级科学数据产
品存入数据库供科学用户使用。一共包含14 条2 级流水线。
巡天模块0 级、1 级和2 级处理流水线总由共31 条分支流水
线组成，主要流水线列表和对应的流水线编号详见表10.5 。
表10.5 巡天模块主要流水线列表
总流水线
次级流水线
分支流水线
流水线编号
巡天模块
0 级处理
流水线
多色成像图像评估
流水线
多色成像图像评估流
水线
KSC-SJ1-PL0-01
无缝光谱图像评估
流水线
无缝光谱图像评估流
水线
KSC-SJ2-PL0-01
巡天模块
1 级处理
流水线
多色成像正常图像
数据处理日常流水
线
单幅图像处理流水线
KSC-SJ1-PL1-01
多色成像特殊图像
密集星场处理流水线
KSC-SJ1-PL1-02
46
数据处理日常流水
线
近邻可分解星系处理
流水线
KSC-SJ1-PL1-03
近邻大星系处理流水
线
KSC-SJ1-PL1-04
星云处理流水线
KSC-SJ1-PL1-05
星系团处理流水线
KSC-SJ1-PL1-06
饱和污染处理流水线
KSC-SJ1-PL1-07
天体测量正常图像
数据处理日常流水
线
中等密度星场天体测
量初处理流水线
KSC-SJ9-PL1-01
天体测量特殊图像
数据处理日常流水
线
低密度星场天体测量
初处理流水线
KSC-SJ9-PL1-02
高密度星场天体测量
初处理流水线
KSC-SJ9-PL1-03
太阳系快速移动天
体检测识别流水线
太阳系快速移动天体
检测识别流水线
KSC-SJ9-PL1-04
无缝光谱图像数据
处理日常流水线
无缝光谱初步处理流
水线
KSC-SJ2-PL1-01
伪直接成像流水线
KSC-SJ2-PL1-02
无缝光谱精确处理流
水线
KSC-SJ2-PL1-03
巡天模块
2 级处理
总流水线
多色成像数据产品
生成流水线
合并星表流水线
KSC-SJ1-PL2-01
PSF 均匀化流水线
KSC-SJ1-PL2-02
合并图像数据流水线
KSC-SJ1-PL2-03
星系红移流水线
KSC-SJ1-PL2-04
强引力透镜源表生成
流水线
KSC-SJ1-PL2-05
恒星星表参数生成流
水线
KSC-SJ1-PL2-06
高精度流量定标流水
线
KSC-SJ1-PL2-07
多色成像2 +级流水
线（科学团队）
KSC-SJ1-PL2-08
天体测量数据产品
生成流水线
天测高精度单帧图像
相对定位流水线
KSC-SJ9-PL2-01
天体测量5 参数计
算流水线
KSC-SJ9-PL2-02
太阳系快速移动天体
KSC-SJ9-PL2-03
47
8.1.3.1
巡天模块0 级处理流水线
1. 多色成像0 级处理流水线
多色成像0 级数据处理流水线类型只有多色成像图像评估流水
线。在每天的观测数据下来后，首先进行QC0 的科学可用性标记，
然后立即触发图像评估工作包，进行图像的类型检测，针对多色测
光功能将图像分成正常图像（II0）和特殊图像。特殊图像包括：密
集星场图像（I3）、近邻可分解星系图像（II1）、近邻大星系图像
（II2）、星云天区图像（II3）、星系团图像（II4）、饱和污染图像
（II5）等；针对天体测量功能根据图像中的恒星密度和参考星表中
的恒星密度，将图像分为低密度星场天区（I1），中等密度星场天
区（I2），高密度星场天区（I3），完成多色成像0 级处理流水线。
多色成像0 级处理流水线图见图10.4（流水线编号：KSC-SJ1-PL0-
01）。
0级图像
Q
C0
天测图像评估
多色成像图像
评估
低密度
标志
（I 1）
中密度
标志
（I 2）
高密度
标志
（I 3）
正常图
像标志
（I I 0）
近邻可
分解星
系标志
（I 1）
近邻大
星系标
志
（I 2）
星云区
标志
（I 3）
饱和污
染标志
（I I 5）
已知星
系团标
志
（I I 4）
轨道确定流水线
无缝光谱数据产品
生成流水线
基于目标源的一维光
谱处理流水线
KSC-SJ2-PL2-01
基于正向建模的一维
光谱抽取流水线
KSC-SJ2-PL2-02
星表生成流水线
KSC-SJ2-PL2-03
无缝光谱2 +级流水
线（科学团队）
KSC-SJ2-PL2-04
48
图10.4 多色成像0 级处理流水线
2. 无缝光谱0 级处理流水线
无缝光谱0 级数据处理流水线主要包括图像评估流水线。在每
天的观测数据下来后，首先进行QC0 的科学可用性标记，然后立即
触发图像评估工作包，进行无缝光谱图像的类型检测，将图像分成
正常图像和特殊图像，完成0 级处理流水线。无缝光谱0 级处理流
水线图见图10.5（流水线编号：KSC-SJ2-PL0-01）。
Q
C0
无缝光谱0级1
次曝光数据
图像评估
正常无缝光谱图像
密集星场光谱图像
特殊图像
星系团光谱图像
近邻大星系光谱图像
星云光谱图像
图10.5 无缝光谱0 级处理总流水线图
8.1.3.2
巡天模块1 级处理流水线
1. 多色成像1 级处理流水线
多色成像1 级处理流水线包括2 两个流程，多色成像正常图像
数据处理日常流程和多色成像特殊图像数据处理日常流程，共7 条
流水线。其中正常图像数据处理日常流程包含1 条流水线-单幅图像
处理流水线；多色成像特殊图像数据处理日常流程包括6 条流水线：
密集星场处理流水线、近邻可分解星系处理流水线、近邻大星系处
理流水线、星云处理流水线、星系团流水线和饱和污染流水线。各
条流水线详细说明如下：
1) 单幅图像处理流水线
每天数据下传就绪后，在经过图像评估流水线，图像评估模块
判断为正常图像的，触发单幅图像处理流水线。目前假设探测器为
CCD。详细过程如下：在辅助图像及基本参数文件以及仪器效应改
正得到的带权重的图像和flag 图像都具备的条件下，单幅图像处理
流水线可以被触发运行。单幅图像流水线的触发最小单元是一幅原
始科学图像。图像经过overscan 改正后，从参考图像数据库中提取
相关的辅助图像和参数文件，然后进入仪器效应改正流水线进行各
49
种不同类型的探测器效应改正。然后进行目标检测获取天体在探测
器上的位置。在此基础上，与外部星表进行交叉匹配，计算得到图
像的世界坐标系框架（WCS），实现天测位置定标功能。在正确的
世界坐标系框架下，再次利用外部星表和在轨定标流水线的结果，
计算得到单幅图像的流量零点，完成天体流量定标。在定标后的图
像上可以进行星表提取，定标后的单次曝光科学图像和单次曝光星
表会归档存入数据库。图10.6 是单幅图像处理流水线图（流水线编
号：KSC-SJ1-PL1-01）。
辅助图像及
参数文件
仪器效应
改正
外部流量参考星表
及在轨定标结果
星表提取
数据库
流量定标
单次曝光星表
位置定标
外部位置
参考星表
单次曝光
原始图像
（18块探测器）
单次曝光科学图
像级对应W
ei ght
和Fl ag图像
1级科学图像
数据
Q
C1
Q
C2
目标检测
目标位置
星表
图10.6 单幅图像处理流水线图
2) 密集星场图像处理流水线
每天数据下传就绪后，在经过图像评估流水线，通过其中的图
像评估模块判断为特殊图像中的密集星场图像，触发密集星场图像
处理流水线，得到经过1 级处理的密集星场图像。密集星场图像处
理流水线图见图10.7（流水线编号：KSC-SJ1-PL1-02）。多色成像
密集星场流水线在标准单幅图像数据处理流水线之上增加对密集星
场中高度重叠天体的识别和证认，证认其中的背景星系，使用PSF
测光完成星表提取。
辅助图像及
参数文件
仪器效应
改正
外部流量参考星表
及在轨定标结果
密集星场
星表提取
数据库
流量定标
单次曝光星表
位置定标
外部位置
参考星表
单次曝光
原始图像
（18块探测器）
单次曝光科学图
像级对应W
ei ght
和Fl ag图像
1级科学图像
数据
Q
C1
Q
C2
密集星场
目标检测
目标位置
星表
重叠位置
星表
图10.7 密集星场图像处理流水线图
3) 近邻可分解星系图像处理流水线
50
每天数据下传就绪后，在经过图像评估流水线，通过其中的图
像评估模块判断为特殊图像中的近邻可分解星系图像，触发近邻可
分解星系图像处理流水线，得到经过1 级处理的近邻可分解星系图
像。这一处理过程主要以密集星场中证认来源于星系以及前景的点
源目标，使用PSF 测光完成星表提取。由于近邻星系中大多数恒星
不会在现有星表中查询到，因此位置定标需要特殊处理。一种可选
的解决方案是在现有阶段仅仅依赖望远镜位置和像场畸变经验模型
给出粗略的位置定标方案来，在证认前景恒星后再专门实现精确位
置定标。近邻可分解星系图像处理流水线图见图10.8（流水线编号：
KSC-SJ1-PL1-03）。
辅助图像及
参数文件
仪器效应
改正
外部流量参考星表
及在轨定标结果
前景星识
别
初步
测光
近邻可分解星系
单次曝光星表
初步
位置定标
外部位置
参考星表
单次曝光
原始图像
（18块探测器）
单次曝光科学图
像级对应W
ei ght
和Fl ag图像
Q
C1
Q
C2
密集星场
目标检测
目标位置
星表
重叠位置
星表
二次位置
定标
流量定标
近邻可分
解星系星
表提取
数据库
1级科学图
像数据
图10.8 近邻可分解星系图像处理流水线图
4) 近邻大星系图像处理流水线
每天数据下传就绪后，在经过图像评估流水线，通过其中的图
像评估模块判断为特殊图像中的近邻大星系图像，触发近邻大星系