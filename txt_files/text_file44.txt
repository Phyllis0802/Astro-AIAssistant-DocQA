Flat 改正后的
改正不同像素间对光子
71
生的改正
图像，合
并后的
flat 参考
图像
图像
响应的差异
5
宇宙线探测及改
正
上一步产
生的改正
图像
宇宙线改正后
图像，及受宇
宙线影响的像
素flag 图像
探测图像中的宇宙线，
对其进行标记并改正
6
非线性改正
上一步产
生的改正
图像，非
线性系数
文件
非线性改正后
的图像
对光电转换中的非线性
效应进行修正
7
卫星干扰条纹探
测及改正
上一步产
生的改正
图像
干扰扣除后的
图像，受干扰
像素flag 图
像
探测图像中的卫星轨迹
等干扰，对其进行标记
及改正
8.1.4.4
多色成像目标检测工作包
该工作包主要对单幅图像进行目标探测并测量基本的目标信息。输
入为经过探测器效应改正的0.5 级数据，通过目标检测得到目标在
天体中的位置信息，是为位置定标和流量定标做准备。多色成像目
标检测工作包流程图见图10.37（工作包编号：KSC-SJ1-PK-04），
模块列表和功能详见表10.10。
图10.37 多色成像目标检测工作包流程图
表10.10 多色成像目标检测工作包模块列表
序号
功能模块名称
输入
输出
实现功能
1
星场目标检测
完成仪器效
应改正的
0.5 级数据
检测到的天
体的位置信
息
得到检测到的星场中天
体的位置信息
8.1.4.5
多色成像位置定标工作包
该工作包主要是对仪器效应改正后单次曝光的科学图像完成位
置定标。首先对单次曝光图像进行位置探测和简单测光，提取出带
完成仪器效
应改正的0. 5
级数据
星场目标检
测
天体的位置
信息
72
有位置和星等信息的临时星表；然后进行仪器效应改正，主要是检
测前期的CTE 效应是否改正完全，进行图像畸变的计算和修正、以
及其它未知的效应带来位置变化的改正；然后输入带有位置定标的
参考坐标系统外部参考星表，从参考星表中提取出待定标天区图像
所对应的参考位置和流量信息，构建出一个参考星表，进行图像像
素坐标(X,Y)到天球坐标(Ra,Dec)的转换，实现图像WCS 结构参数
的计算，完成位置定标，最后输出WCS 结构参数的head 文件（包
含了基本WCS 参数和畸变修正）。多色成像位置定标工作包流程
图见图10.38（工作包编号：KSC-SJ1-PK-05）, 模块列表和功能详
见表10.11。
目标探测和参数测量
W
CS结构参数和H
ead文
件
仪器效应改正后单次曝
光的科学图像，wei ght
图像，f l ag图像
图像W
CS结构参数的计算
外部参考星表
参考星表构建
包括位置和流量信息的临
时星表
CTE效应位置检测
图像畸变位置改正
其他效应位置改正
图10.38 多色成像位置定标工作包流程图
表10.11 多色成像位置定标工作包模块列表
序号
功能模块名称
输入
输出
实现功能
1
目标探测和参
数测量
完成仪器效应改
正后的图像
图像中天体的位
置、流量和基本
形态信息
对单幅图像进行
目标探测并测量
基本的目标信息
2
参考星表构建
外部参考星表，
如
2MASS ，
SDSS，GAIA
包含位置和流量
信息的星表
构建具有准确位
置信息的参考星
表
3
仪器效应的位
置改正
图像中天体的位
置和流量信息
经效应改正后的
天体位置
通过CTE 效应位
置检测、图像畸
变位置改正、其
他效应位置改正
得到改正后的天
体位置
73
4
图像WCS 结
构参数的计算
天体的位置和流
量信息
WCS 结构参数
的head 文件
WCS 结构参数计
算
8.1.4.6
多色成像流量定标工作包
该工作包主要是通过输入位置定标信息、位置定标得到的图像
测光星表和外部参考星表完成流量定标工作。首先进行测光星表的
位置信息更新，得到相同天区位置处的参考星表（包括位置和相应
的星等信息），然后对测光星表和参考星表按天体位置进行交叉匹
配，并对匹配源按测光质量、星等信噪比、颜色分布等进行筛选，
得到用于定标零点计算的参考目标源。多色成像流量定标工作包流
程及模块分解图见图10.39（工作包编号：KSC-SJ1-PK-06）, 模块
列表和功能详见表10.12。
位置定标信息、位置
定标得到的图像测光
星表
测光星表的位置信息更新
筛选可用定标源
计算定标零点
将定标信息加入
图像文件头
添加定标信息后的单
幅科学图像头文件
各滤光片颜色项改正
及测光平场改正
图像天区位置的外部参考
星表
流量外部参考星表
图10.39 多色成像流量定标工作包
表10.12 多色成像流量定标工作包模块列表
序号
功能模块名称
输入
输出
实现功能
1
测光星表的位置信息更
新
位置定标得到的
图像测光星表和
包含位置定标信
息的图像头文件
图像中天体
的位置和流
量信息
得到天体临时文件：
包括位置定标更新后
的位置信息和流量信
息
2
图像天区位置的外部参
考星表
图像中天体的位
置信息；外部参
考星表库
图像天区位
置对应的外
部参考星表
得到图像天区位置的
外部参考星表
3
筛选可用定标源
图像中天体的位
置和流量信息；
图像天区位置对
应的外部参考星
表的位置和流量
信息
用于定标零
点计算的参
考目标源
（位置和对
应的仪器星
等和参考星
等）
对测光星表和参考星
表按天体位置进行交
叉匹配，并对匹配源
按测光质量、星等信
噪比、颜色分布等进
行筛选，得到用于定
标零点计算的参考目
标源。
74
4
图像流量零点的计算
用于定标零点计
算的参考目标源
（位置和对应的
仪器星等和参考
星等）
；颜色项
和测光平场的改
正方程
单幅图像的
流量零点以
及相应的流
量定标信息
将参考目标源的测光
星等（测光平场改正
后）和参考星等（颜
色项改正后）进行比
较和拟合，由此计算
得到单幅图像的流量
零点
5
图像文件头信息更新
单幅图像的流量
零点以及相应的
流量定标信息；
位置定标得到的
图像头文件
包含流量定
标信息和位
置定标信息
的图像头文
件
将流量定标零点和定
标相关信息添加到图
像文件头，并保存更
新到额外的图像头文
件。
8.1.4.7
多色成像单次曝光星表提取工作包
该工作包负责在完成定标后的单次曝光图像上对天体目标源进
行探测，并对这些目标源进行各种类型的测光，最终获得单次曝光
科学图像星表。这一过程主要包括了如下数据分析过程：天光背景
估计、目标探测、点扩散函数建模、目标形态测量、测光分析（包
括孔径测光、PSF 测光和模型测光等）和恒星/星系分类等。单次曝
光星表提取工作包的流程图10.40（工作包编号：KSC-SJ1-PK-07），
模块列表和功能详见表10.13。
天光背景估计
定标后的单次曝光科
学图像对应的权重和
mask图像
天光背景图像
目标探测和参数测量
PSF建模
PSF模型
孔径测光
PSF测光
模型测光
单波段恒星、星系分
类
单次曝光测光星表
图10.40 多色成像单次曝光星表提取工作包流程图。
表10.13 多色成像单次曝光星表提取工作包模块列表
序号
功能模块
名称
输入
输出
实现功能
1
天光背景
估计
定标后的图像，
权重图像和标记
图像
天光背景图像和
天光背景起伏图
像
通过二次天
光估计的方
法获得天光
背景图像
75
2
目标探测
和参数测
量
完成仪器效应改
正后的图像
图像中天体的位
置，流量和基本
形态信息
对单幅图像
进行目标探
测并测量基
本的目标信
息
3
PSF 建模
PSF 星的截取图
像
空间变化的PSF
模型
选取合适的
PSF 星，进行
PSF 建模构建
空间变化的
PSF 模型
4
孔径测光
扣除天光后的图
像，权重图像，
mask 图像
圆孔径测光信息
根据目标探
测结果在图
像上进行圆
孔径测光。
5
Kron 孔径
测光
扣除天光后的图
像，权重图像，
mask 图像
Kron 孔径测光信
息
根据目标探
测结果在图
像上进行
Kron 孔径测
光。
6
PSF 测光
扣除天光后的图
像，权重图像，
mask 图像和PSF
模型
PSF 测光信息
根据目标探
测结果在图
像上进行
PSF 测光。
7
模型测光
扣除天光后的图
像，权重图像，
mask 图像和PSF
模型
模型测光信息
根据目标探
测结果在图
像上进行各
种模型测光
8
单图像恒
星星系分
类
单波段测光星表
恒星星系分类后
的星表
利用单波段
测光测量结
果给出恒星
星系分类
8.1.4.8
多色成像1 级数据可用性标记工作包
该工作包针对多色成像1 级数据图像，目的是保证多色成像1
级数据处理过程中没有出现显著影响多色成像2 级数据结果的错误，
使得多色成像1 级数据结果满足多色成像2 级数据生成观测源表的
需求。多色成像1 级数据可用性标记工作包流程图见图10.41（工
作包编号：KSC-SJ1-PK-08），模块列表和功能详见表10.14。
76
1级定标后
图像数据
完整性检查
阈值检查
性能指标项检查
与追踪
1级数据可用性标记检查
需要重复定标项
标记
边界检查
完备性检查
特殊天区检查
与标记
完成度标记
Q
C检查报告及辅
助头文件
数据库
（1级数据）
图10.41 多色成像1 级数据可用性标记工作包流程图
表10.14 多色成像1 级数据可用性标记工作包模块列表
序号
功能功能模块
名称
输入
输出
实现功能
1
1 级数据可用性
标记
1 级定标
后图像
QC 检查
报告
保证1 级数据中影响后续数据
处理的参数得到适当的标记。
2
完成度标记
1 级定标
后图像
完成度
检查观测天区数据是否达到预
设指标
8.1.4.9
多色成像密集星场目标检测工作包
密集星场恒星数目超过1000 万/平方度，约合30 万颗星/探测
器（11´×11´）。在此情况下天体混叠效应非常明显，需要目标检
测过程中充分考虑混叠效应，并从混叠程度不高（间距大于0.05 像
元、总流量尚未饱和）的星中识别单颗恒星出来。这一工作包的输
入是完成仪器效应改正的0.5 级单探测器单次曝光图像，经过处理
之后获得天体目标在探测器参考系中的位置（X，Y），用于稍后的
位置定标、流量定标和恒星测光。应该在输出中对每个天体的混叠
程度给出标记。对混叠严重且无法识别单个天体的区域应给出标记
并生成掩码图像。多色成像密集星场目标检测工作包流程图见图
10.42（工作包编号：KSC-SJ1-PK09），模块列表和功能见表10.15。
77
图10.42 多色成像密集星场目标检测工作包流程图
表10.15 多色成像密集星场目标检测工作包模块列表
序号
模块名称
输入
输出
实现功能
1
密集星场目标检测
完成仪器效应
改正后的0.5
级数据
检测到密集星场
中的目标
标记检测到
的密集星场
中的目标
2
密集星场混叠分析
密集星场中天
体的目标
天体的探测器位
置信息，包含混
叠情况标记和严
重混叠区的掩码
图像
得到密集星
场中的天体
位置信息并
给与标记
8.1.4.10 多色成像密集星场初步位置定标工作包
采用和标准星场位置定标同样的方式完成位置定标。此过程中
可能因为星场较为密集导致位置精度有很大下降。这将在密集星场
二次位置定标的过程中进行优化和改进。此过程的输入为目标检测
得到的标记了天体在探测器参考系（X，Y）中的位置的目标星表。
工作包的输出为WCS 参数。多色成像密集星场初步位置定标工作
包流程图见图10.43（工作包编号：KSC-SJ1-PK10），模块列表和
功能见表10.16。
天体的探测
器位置信
息，包含混
叠情况标记
（标准）位
置定标
W
CS结构和
head文件
图10.43 多色成像密集星场初步位置定标工作包流程图